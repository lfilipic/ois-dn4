{"filter":false,"title":"demo.js","tooltip":"/demo.js","undoManager":{"mark":100,"position":100,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":457,"column":1},"action":"remove","lines":["","var baseUrl = 'https://rest.ehrscape.com/rest/v1';","var queryUrl = baseUrl + '/query';","","var username = \"ois.seminar\";","var password = \"ois4fri\";","","function getSessionId() {","    var response = $.ajax({","        type: \"POST\",","        url: baseUrl + \"/session?username=\" + encodeURIComponent(username) +","                \"&password=\" + encodeURIComponent(password),","        async: false","    });","    return response.responseJSON.sessionId;","}","","var uporabniki [] ; ","","function kreirajEHRzaBolnika() {","\tsessionId = getSessionId();","","\tvar ime = $(\"#kreirajIme\").val();","\tvar priimek = $(\"#kreirajPriimek\").val();","\tvar datumRojstva = $(\"#kreirajDatumRojstva\").val();","","\tif (!ime || !priimek || !datumRojstva || ime.trim().length == 0 || priimek.trim().length == 0 || datumRojstva.trim().length == 0) {","\t\t$(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim vnesite zahtevane podatke!</span>\");","\t} else {","\t\t$.ajaxSetup({","\t\t    headers: {\"Ehr-Session\": sessionId}","\t\t});","\t\t$.ajax({","\t\t    url: baseUrl + \"/ehr\",","\t\t    type: 'POST',","\t\t    success: function (data) {","\t\t        var ehrId = data.ehrId;","\t\t        var partyData = {","\t\t            firstNames: ime,","\t\t            lastNames: priimek,","\t\t            dateOfBirth: datumRojstva,","\t\t            partyAdditionalInfo: [{key: \"ehrId\", value: ehrId}]","\t\t        };","\t\t        $.ajax({","\t\t            url: baseUrl + \"/demographics/party\",","\t\t            type: 'POST',","\t\t            contentType: 'application/json',","\t\t            data: JSON.stringify(partyData),","\t\t            success: function (party) {","\t\t                if (party.action == 'CREATE') {","\t\t                    $(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>Uspešno kreiran EHR '\" + ehrId + \"'.</span>\");","\t\t                    console.log(\"Uspešno kreiran EHR '\" + ehrId + \"'.\");","\t\t                    $(\"#preberiEHRid\").val(ehrId);","\t\t                }","\t\t            },","\t\t            error: function(err) {","\t\t            \t$(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t            \tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t            }","\t\t        });","\t\t    }","\t\t});","\t}","}","","","function preberiEHRodBolnika() {","\tsessionId = getSessionId();","","\tvar ehrId = $(\"#preberiEHRid\").val();","","\tif (!ehrId || ehrId.trim().length == 0) {","\t\t$(\"#preberiSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim vnesite zahtevan podatek!\");","\t} else {","\t\t$.ajax({","\t\t\turl: baseUrl + \"/demographics/ehr/\" + ehrId + \"/party\",","\t\t\ttype: 'GET',","\t\t\theaders: {\"Ehr-Session\": sessionId},","\t    \tsuccess: function (data) {","\t\t\t\tvar party = data.party;","\t\t\t\t$(\"#preberiSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>Bolnik '\" + party.firstNames + \" \" + party.lastNames + \"', ki se je rodil '\" + party.dateOfBirth + \"'.</span>\");","\t\t\t\tconsole.log(\"Bolnik '\" + party.firstNames + \" \" + party.lastNames + \"', ki se je rodil '\" + party.dateOfBirth + \"'.\");","\t\t\t},","\t\t\terror: function(err) {","\t\t\t\t$(\"#preberiSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t}","\t\t});","\t}\t","}","","","function dodajMeritveVitalnihZnakov() {","\tsessionId = getSessionId();","","\tvar ehrId = $(\"#dodajVitalnoEHR\").val();","\tvar datumInUra = $(\"#dodajVitalnoDatumInUra\").val();","\tvar telesnaVisina = $(\"#dodajVitalnoTelesnaVisina\").val();","\tvar telesnaTeza = $(\"#dodajVitalnoTelesnaTeza\").val();","\tvar telesnaTemperatura = $(\"#dodajVitalnoTelesnaTemperatura\").val();","\tvar sistolicniKrvniTlak = $(\"#dodajVitalnoKrvniTlakSistolicni\").val();","\tvar diastolicniKrvniTlak = $(\"#dodajVitalnoKrvniTlakDiastolicni\").val();","\tvar nasicenostKrviSKisikom = $(\"#dodajVitalnoNasicenostKrviSKisikom\").val();","\tvar merilec = $(\"#dodajVitalnoMerilec\").val();","","\tif (!ehrId || ehrId.trim().length == 0) {","\t\t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim vnesite zahtevane podatke!</span>\");","\t} else {","\t\t$.ajaxSetup({","\t\t    headers: {\"Ehr-Session\": sessionId}","\t\t});","\t\tvar podatki = {","\t\t\t// Preview Structure: https://rest.ehrscape.com/rest/v1/template/Vital%20Signs/example","\t\t    \"ctx/language\": \"en\",","\t\t    \"ctx/territory\": \"SI\",","\t\t    \"ctx/time\": datumInUra,","\t\t    \"vital_signs/height_length/any_event/body_height_length\": telesnaVisina,","\t\t    \"vital_signs/body_weight/any_event/body_weight\": telesnaTeza,","\t\t   \t\"vital_signs/body_temperature/any_event/temperature|magnitude\": telesnaTemperatura,","\t\t    \"vital_signs/body_temperature/any_event/temperature|unit\": \"°C\",","\t\t    \"vital_signs/blood_pressure/any_event/systolic\": sistolicniKrvniTlak,","\t\t    \"vital_signs/blood_pressure/any_event/diastolic\": diastolicniKrvniTlak,","\t\t    \"vital_signs/indirect_oximetry:0/spo2|numerator\": nasicenostKrviSKisikom","\t\t};","\t\tvar parametriZahteve = {","\t\t    \"ehrId\": ehrId,","\t\t    templateId: 'Vital Signs',","\t\t    format: 'FLAT',","\t\t    committer: merilec","\t\t};","\t\t$.ajax({","\t\t    url: baseUrl + \"/composition?\" + $.param(parametriZahteve),","\t\t    type: 'POST',","\t\t    contentType: 'application/json',","\t\t    data: JSON.stringify(podatki),","\t\t    success: function (res) {","\t\t    \tconsole.log(res.meta.href);","\t\t        $(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>\" + res.meta.href + \".</span>\");","\t\t    },","\t\t    error: function(err) {","\t\t    \t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t    }","\t\t});","\t}","}","","","function preberiMeritveVitalnihZnakov() {","\tsessionId = getSessionId();\t","","\tvar ehrId = $(\"#meritveVitalnihZnakovEHRid\").val();","\tvar tip = $(\"#preberiTipZaVitalneZnake\").val();","","\tif (!ehrId || ehrId.trim().length == 0 || !tip || tip.trim().length == 0) {","\t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim vnesite zahtevan podatek!\");","\t} else {","\t\t$.ajax({","\t\t\turl: baseUrl + \"/demographics/ehr/\" + ehrId + \"/party\",","\t    \ttype: 'GET',","\t    \theaders: {\"Ehr-Session\": sessionId},","\t    \tsuccess: function (data) {","\t\t\t\tvar party = data.party;","\t\t\t\t$(\"#rezultatMeritveVitalnihZnakov\").html(\"<br/><span>Pridobivanje podatkov za <b>'\" + tip + \"'</b> bolnika <b>'\" + party.firstNames + \" \" + party.lastNames + \"'</b>.</span><br/><br/>\");","\t\t\t\tif (tip == \"telesna temperatura\") {","\t\t\t\t\t$.ajax({","\t\t\t\t\t    url: baseUrl + \"/view/\" + ehrId + \"/\" + \"body_temperature\",","\t\t\t\t\t    type: 'GET',","\t\t\t\t\t    headers: {\"Ehr-Session\": sessionId},","\t\t\t\t\t    success: function (res) {","\t\t\t\t\t    \tif (res.length > 0) {","\t\t\t\t\t\t    \tvar results = \"<table class='table table-striped table-hover'><tr><th>Datum in ura</th><th class='text-right'>Telesna temperatura</th></tr>\";","\t\t\t\t\t\t        for (var i in res) {","\t\t\t\t\t\t            results += \"<tr><td>\" + res[i].time + \"</td><td class='text-right'>\" + res[i].temperature + \" \" \t+ res[i].unit + \"</td>\";","\t\t\t\t\t\t        }","\t\t\t\t\t\t        results += \"</table>\";","\t\t\t\t\t\t        $(\"#rezultatMeritveVitalnihZnakov\").append(results);","\t\t\t\t\t    \t} else {","\t\t\t\t\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");","\t\t\t\t\t    \t}","\t\t\t\t\t    },","\t\t\t\t\t    error: function() {","\t\t\t\t\t    \t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t\t\t    }","\t\t\t\t\t});","\t\t\t\t} else if (tip == \"telesna teža\") {","\t\t\t\t\t$.ajax({","\t\t\t\t\t    url: baseUrl + \"/view/\" + ehrId + \"/\" + \"weight\",","\t\t\t\t\t    type: 'GET',","\t\t\t\t\t    headers: {\"Ehr-Session\": sessionId},","\t\t\t\t\t    success: function (res) {","\t\t\t\t\t    \tif (res.length > 0) {","\t\t\t\t\t\t    \tvar results = \"<table class='table table-striped table-hover'><tr><th>Datum in ura</th><th class='text-right'>Telesna teža</th></tr>\";","\t\t\t\t\t\t        for (var i in res) {","\t\t\t\t\t\t            results += \"<tr><td>\" + res[i].time + \"</td><td class='text-right'>\" + res[i].weight + \" \" \t+ res[i].unit + \"</td>\";","\t\t\t\t\t\t        }","\t\t\t\t\t\t        results += \"</table>\";","\t\t\t\t\t\t        $(\"#rezultatMeritveVitalnihZnakov\").append(results);","\t\t\t\t\t    \t} else {","\t\t\t\t\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");","\t\t\t\t\t    \t}","\t\t\t\t\t    },","\t\t\t\t\t    error: function() {","\t\t\t\t\t    \t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t\t\t    }","\t\t\t\t\t});\t\t\t\t\t","\t\t\t\t} else if (tip == \"telesna temperatura AQL\") {","\t\t\t\t\tvar AQL = ","\t\t\t\t\t\t\"select \" +","    \t\t\t\t\t\t\"t/data[at0002]/events[at0003]/time/value as cas, \" +","    \t\t\t\t\t\t\"t/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/magnitude as temperatura_vrednost, \" +","    \t\t\t\t\t\t\"t/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/units as temperatura_enota \" +","\t\t\t\t\t\t\"from EHR e[e/ehr_id/value='\" + ehrId + \"'] \" +","\t\t\t\t\t\t\"contains OBSERVATION t[openEHR-EHR-OBSERVATION.body_temperature.v1] \" +","\t\t\t\t\t\t\"where t/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/magnitude<35 \" +","\t\t\t\t\t\t\"order by t/data[at0002]/events[at0003]/time/value desc \" +","\t\t\t\t\t\t\"limit 10\";","\t\t\t\t\t$.ajax({","\t\t\t\t\t    url: baseUrl + \"/query?\" + $.param({\"aql\": AQL}),","\t\t\t\t\t    type: 'GET',","\t\t\t\t\t    headers: {\"Ehr-Session\": sessionId},","\t\t\t\t\t    success: function (res) {","\t\t\t\t\t    \tvar results = \"<table class='table table-striped table-hover'><tr><th>Datum in ura</th><th class='text-right'>Telesna temperatura</th></tr>\";","\t\t\t\t\t    \tif (res) {","\t\t\t\t\t    \t\tvar rows = res.resultSet;","\t\t\t\t\t\t        for (var i in rows) {","\t\t\t\t\t\t            results += \"<tr><td>\" + rows[i].cas + \"</td><td class='text-right'>\" + rows[i].temperatura_vrednost + \" \" \t+ rows[i].temperatura_enota + \"</td>\";","\t\t\t\t\t\t        }","\t\t\t\t\t\t        results += \"</table>\";","\t\t\t\t\t\t        $(\"#rezultatMeritveVitalnihZnakov\").append(results);","\t\t\t\t\t    \t} else {","\t\t\t\t\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");","\t\t\t\t\t    \t}","","\t\t\t\t\t    },","\t\t\t\t\t    error: function() {","\t\t\t\t\t    \t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t\t\t    }","\t\t\t\t\t});","\t\t\t\t}","\t    \t},","\t    \terror: function(err) {","\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t    \t}","\t\t});","\t}","}","","function ustvariUporabnika(ime, priimek, datum)","{","","","\t\t$.ajaxSetup({","\t\t    headers: {\"Ehr-Session\": sessionId}","\t\t});","\t\t$.ajax({","\t\t    url: baseUrl + \"/ehr\",","\t\t    type: 'POST',","\t\t    success: function (data) {","\t\t        var ehrId = data.ehrId;","\t\t        var partyData = {","\t\t            firstNames: ime,","\t\t            lastNames: priimek,","\t\t            dateOfBirth: datum,","\t\t            partyAdditionalInfo: [{key: \"ehrId\", value: ehrId}]","\t\t        };","\t\t        $.ajax({","\t\t            url: baseUrl + \"/demographics/party\",","\t\t            type: 'POST',","\t\t            contentType: 'application/json',","\t\t            data: JSON.stringify(partyData),","\t\t            success: function (party) {","\t\t                if (party.action == 'CREATE') {","\t\t                    $(\"#obvestiloNarediUporabnika\").html(\"<span class='obvestilo label label-success fade-in'>Uspešno kreiran EHR '\" + ehrId + \"'.</span>\");","\t\t                    console.log(\"Uspešno kreiran uporabnik'\" + ehrId + \"'.\");","\t\t                    uporabniki[uporabniki.length] = ehrId;","\t\t                }","\t\t            },","\t\t            error: function(err) {","\t\t            \t$(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t            \tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t            }","\t\t        });","\t\t    }","\t\t});","\t\t","}","","$(document).ready(function() {","\t$('#preberiObstojeciEHR').change(function() {","\t\t$(\"#preberiSporocilo\").html(\"\");","\t\t$(\"#preberiEHRid\").val($(this).val());","\t});","\t$('#preberiPredlogoBolnika').change(function() {","\t\t$(\"#kreirajSporocilo\").html(\"\");","\t\tvar podatki = $(this).val().split(\",\");","\t\t$(\"#kreirajIme\").val(podatki[0]);","\t\t$(\"#kreirajPriimek\").val(podatki[1]);","\t\t$(\"#kreirajDatumRojstva\").val(podatki[2]);","\t});","\t$('#preberiObstojeciVitalniZnak').change(function() {","\t\t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"\");","\t\tvar podatki = $(this).val().split(\"|\");","\t\t$(\"#dodajVitalnoEHR\").val(podatki[0]);","\t\t$(\"#dodajVitalnoDatumInUra\").val(podatki[1]);","\t\t$(\"#dodajVitalnoTelesnaVisina\").val(podatki[2]);","\t\t$(\"#dodajVitalnoTelesnaTeza\").val(podatki[3]);","\t\t$(\"#dodajVitalnoTelesnaTemperatura\").val(podatki[4]);","\t\t$(\"#dodajVitalnoKrvniTlakSistolicni\").val(podatki[5]);","\t\t$(\"#dodajVitalnoKrvniTlakDiastolicni\").val(podatki[6]);","\t\t$(\"#dodajVitalnoNasicenostKrviSKisikom\").val(podatki[7]);","\t\t$(\"#dodajVitalnoMerilec\").val(podatki[8]);","\t});","\t$('#preberiEhrIdZaVitalneZnake').change(function() {","\t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"\");","\t\t$(\"#rezultatMeritveVitalnihZnakov\").html(\"\");","\t\t$(\"#meritveVitalnihZnakovEHRid\").val($(this).val());","\t});","});","","function narediTestnegaUporanika()","{","\t","\tsessionId = getSessionId();","\t","\t$.when(ustvariUporabnika(\"Janez\",\"Novak - student\",\"1993-25-10\"),ustvariUporabnika(\"Miha\",\"Kovač - športnik\",\"1983-10-1\"),ustvariUporabnika(\"Srečko\", \"Upokojeni - upokojenec\",\"1943-3-5\")).done(function(){","\t\t","\t\tustvariVitalneZnake(uporabniki[0],\"2014-10-13T11:35Z\",183,98,36,140,78,\"test\");","\t\tustvariVitalneZnake(uporabniki[0],\"2014-11-13T11:35Z\",170,76,37,130,80,\"test\");","\t\tustvariVitalneZnake(uporabniki[0],\"2014-12-13T11:35Z\",176,70,35,145,76,\"test\");","\t\t","\t\t","\t\t","\t\t","\t\t","\t\t","\t})","","\t","}","function ustvariVitalneZnake(uporabnikID, ura, telVis, telTez, telTemp, sisTlak, diaTlak, sestra)","{","\t","\t\tsessionId = getSessionId();","","\t","\t\t$.ajaxSetup({","\t\t    headers: {\"Ehr-Session\": sessionId}","\t\t});","\t\tvar podatki = {","\t\t\t// Preview Structure: https://rest.ehrscape.com/rest/v1/template/Vital%20Signs/example","\t\t    \"ctx/language\": \"en\",","\t\t    \"ctx/territory\": \"SI\",","\t\t    \"ctx/time\": ura,","\t\t    \"vital_signs/height_length/any_event/body_height_length\": telVis,","\t\t    \"vital_signs/body_weight/any_event/body_weight\": telTez,","\t\t   \t\"vital_signs/body_temperature/any_event/temperature|magnitude\": telTemp,","\t\t    \"vital_signs/body_temperature/any_event/temperature|unit\": \"°C\",","\t\t    \"vital_signs/blood_pressure/any_event/systolic\": sisTlak,","\t\t    \"vital_signs/blood_pressure/any_event/diastolic\": diaTlak,","\t\t  //  \"vital_signs/indirect_oximetry:0/spo2|numerator\": nasicenostKrviSKisikom","\t\t};","\t\tvar parametriZahteve = {","\t\t    \"ehrId\": uporabnikID,","\t\t    templateId: 'Vital Signs',","\t\t    format: 'FLAT',","\t\t    committer: sestra","\t\t    ","\t\t};","\t\t$.ajax({","\t\t    url: baseUrl + \"/composition?\" + $.param(parametriZahteve),","\t\t    type: 'POST',","\t\t    contentType: 'application/json',","\t\t    data: JSON.stringify(podatki),","\t\t    success: function (res) {","\t\t    \tconsole.log(res.meta.href);","\t\t        $(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>\" + res.meta.href + \".</span>\");","\t\t    },","\t\t    error: function(err) {","\t\t    \t$(\"#sporociloVitalniZnaki\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t    }","\t\t});","\t","","\t","}","","","function narisiGraf()","{","\tvar margin = {top: 20, right: 20, bottom: 30, left: 50},","    width = 960 - margin.left - margin.right,","    height = 500 - margin.top - margin.bottom;","","var parseDate = d3.time.format(\"%Y%m%d\").parse;","","var x = d3.time.scale()","    .range([0, width]);","","var y = d3.scale.linear()","    .range([height, 0]);","","var xAxis = d3.svg.axis()","    .scale(x)","    .orient(\"bottom\");","","var yAxis = d3.svg.axis()","    .scale(y)","    .orient(\"left\");","","var area = d3.svg.area()","    .x(function(d) { return x(d.date); })","    .y0(function(d) { return y(d.low); })","    .y1(function(d) { return y(d.high); });","","var svg = d3.select(\"body\").append(\"svg\")","    .attr(\"width\", width + margin.left + margin.right)","    .attr(\"height\", height + margin.top + margin.bottom)","  .append(\"g\")","    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");","","d3.tsv(\"data.tsv\", function(error, data) {","  data.forEach(function(d) {","    d.date = parseDate(d.date);","    d.low = +d.low;","    d.high = +d.high;","  });","","  x.domain(d3.extent(data, function(d) { return d.date; }));","  y.domain([d3.min(data, function(d) { return d.low; }), d3.max(data, function(d) { return d.high; })]);","","  svg.append(\"path\")","      .datum(data)","      .attr(\"class\", \"area\")","      .attr(\"d\", area);","","  svg.append(\"g\")","      .attr(\"class\", \"x axis\")","      .attr(\"transform\", \"translate(0,\" + height + \")\")","      .call(xAxis);","","  svg.append(\"g\")","      .attr(\"class\", \"y axis\")","      .call(yAxis)","    .append(\"text\")","      .attr(\"transform\", \"rotate(-90)\")","      .attr(\"y\", 6)","      .attr(\"dy\", \".71em\")","      .style(\"text-anchor\", \"end\")","      .text(\"Temperature (ºF)\");","});","\t","}"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":568,"column":3},"action":"insert","lines":["","","var baseUrl = 'https://rest.ehrscape.com/rest/v1';","var queryUrl = baseUrl + '/query';","","var username = \"ois.seminar\";","var password = \"ois4fri\";","","var graphData = [ ];","","var ehrIDs = [ ];","","function getSessionId() {","    var response = $.ajax({","        type: \"POST\",","        url: baseUrl + \"/session?username=\" + encodeURIComponent(username) +","                \"&password=\" + encodeURIComponent(password),","        async: false","    });","    return response.responseJSON.sessionId;","}","","function runCreateUsers() {","\tsessionId = getSessionId();","","\t$.when(createTestUsers(\"janez\", \"novak\", \"1938-10-11T14:58\"), createTestUsers(\"marko\", \"testni\", \"1993-11-30T11:11\"), createTestUsers(\"jure\", \"medved\", \"1993-07-22T15:26\")).done(function(){","\t\taddVitalSignstoTestUsers(ehrIDs[0], \"2014-12-19T12:20Z\", 183, 85, 36.55, 122, 95, 100, \"test\");","\t\taddVitalSignstoTestUsers(ehrIDs[1], \"2014-10-22T22:30Z\", 190, 90, 37.55, 115, 90, 95, \"test2\");","\t\taddVitalSignstoTestUsers(ehrIDs[2], \"2014-11-05T15:12Z\", 175, 65, 36.20, 115, 90, 105, \"test4\");","\t\tfor(i=0; i<3; i++) {","\t\t\tfor(j=0; j<7; j++) {","\t\t\t\tswitch (i) {","\t\t\t\t\tcase 0:","\t\t\t\t\t\tweight = (Math.random() * 10 + 78).toFixed(1);","\t\t\t\t\t\taddWeight(ehrIDs[i], weight);","\t\t\t\t\t\tbreak;","\t\t\t\t\tcase 1:","\t\t\t\t\t\tweight = (Math.random() * 11 + 85).toFixed(1);","\t\t\t\t\t\taddWeight(ehrIDs[i], weight);","\t\t\t\t\t\tbreak;","\t\t\t\t\tcase 2:","\t\t\t\t\t\tweight = (Math.random() * 12 + 60).toFixed(1);","\t\t\t\t\t\taddWeight(ehrIDs[i], weight);","\t\t\t\t\t\tbreak;","\t\t\t\t}","\t\t\t}","\t\t}","\t});","","\t//createGraph();","","}","","function createGraph() {","\tvar margin = {top: 40, right: 20, bottom: 30, left: 40},","\t\twidth = screen.width/2 - 60 - margin.left - margin.right,","\t\theight = 500 - margin.top - margin.bottom;","","\tvar x = d3.scale.ordinal()","\t\t.rangeRoundBands([0, width], .1);","","\tvar y = d3.scale.linear()","\t\t.range([height, 0]);","\t\t//.range([0, 100])","","\tvar xAxis = d3.svg.axis()","\t\t.scale(x)","\t\t.orient(\"bottom\");","","\tvar yAxis = d3.svg.axis()","\t\t.scale(y)","\t\t.orient(\"left\")","\t\t//.range([0, 100])","\t\t//.tickFormat(formatPercent);","","\tvar tip = d3.tip()","\t\t.attr('class', 'd3-tip')","\t\t.offset([-10, 0])","\t\t.html(function(d) {","\t\t\treturn \"<strong>Teza:</strong> <span style='color:Green'>\" + d.frequency + \"</span>\";","\t\t})","","\tvar svg = d3.select(\"#graphWeight\").append(\"svg\")","\t\t.attr(\"width\", width + margin.left + margin.right)","\t\t.attr(\"height\", height + margin.top + margin.bottom)","\t\t.append(\"g\")","\t\t.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");","","\tsvg.call(tip);","","\t\tx.domain(graphData.map(function(d) { return d.letter; }));","\t\ty.domain([0, d3.max(graphData, function(d) { return d.frequency; })]);","","\t\tsvg.append(\"g\")","\t\t\t.attr(\"class\", \"x axis\")","\t\t\t.attr(\"transform\", \"translate(0,\" + height + \")\")","\t\t\t.call(xAxis);","","\t\tsvg.append(\"g\")","\t\t\t.attr(\"class\", \"y axis\")","\t\t\t.call(yAxis)","\t\t\t.append(\"text\")","\t\t\t//.attr(\"transform\", \"rotate(-90)\")","\t\t\t.attr(\"y\", -20)","\t\t\t.attr(\"dy\", \".71em\")","\t\t\t//.style(\"text-anchor\", \"end\")","\t\t\t.text(\"Teza\");","","\t\tsvg.selectAll(\".bar\")","\t\t\t.data(graphData)","\t\t\t.enter().append(\"rect\")","\t\t\t.attr(\"class\", \"bar\")","\t\t\t.attr(\"x\", function(d) { return x(d.letter); })","\t\t\t.attr(\"width\", x.rangeBand())","\t\t\t.attr(\"y\", function(d) { return y(d.frequency); })","\t\t\t.attr(\"height\", function(d) { return height - y(d.frequency); })","\t\t\t.on('mouseover', tip.show)","\t\t\t.on('mouseout', tip.hide)","","","","\tfunction type(d) {","\t\td.frequency = +d.frequency;","\t\treturn d;","\t}","}","","function createTestUsers(ime, priimek, datumRojstva) {","\tsessionId = getSessionId();","","\t$.ajaxSetup({","\t\theaders: {\"Ehr-Session\": sessionId}","\t});","\t$.ajax({","\t\turl: baseUrl + \"/ehr\",","\t\ttype: 'POST',","\t\tasync: false,","\t\tsuccess: function (data) {","\t\t\tvar ehrId = data.ehrId;","\t\t\tvar partyData = {","\t\t\t\tfirstNames: ime,","\t\t\t\tlastNames: priimek,","\t\t\t\tdateOfBirth: datumRojstva,","\t\t\t\tpartyAdditionalInfo: [{key: \"ehrId\", value: ehrId}]","\t\t\t};","\t\t\treturn $.ajax({","\t\t\t\turl: baseUrl + \"/demographics/party\",","\t\t\t\ttype: 'POST',","\t\t\t\tasync: false,","\t\t\t\tcontentType: 'application/json',","\t\t\t\tdata: JSON.stringify(partyData),","\t\t\t\tsuccess: function (party) {","\t\t\t\t\tif (party.action == 'CREATE') {","\t\t\t\t\t\t$(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>Uspešno kreirani EHR zapisi</span>\");","\t\t\t\t\t\t//console.log(\"Uspešno kreiran EHR zapis \" + ehrId + \"'.\");","\t\t\t\t\t\tehrIDs[ehrIDs.length] = ehrId;","\t\t\t\t\t\tconsole.log(ehrIDs[ehrIDs.length-1]);","\t\t\t\t\t}","\t\t\t\t},","\t\t\t\terror: function(err) {","\t\t\t\t\t//$(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t\t}","\t\t\t});","\t\t}","\t});","","}","","function kreirajEHRzaBolnika() {","\tsessionId = getSessionId();","","\tvar ime = $(\"#kreirajIme\").val();","\tvar priimek = $(\"#kreirajPriimek\").val();","\tvar datumRojstva = $(\"#kreirajDatumRojstva\").val();","","\tif (!ime || !priimek || !datumRojstva || ime.trim().length == 0 || priimek.trim().length == 0 || datumRojstva.trim().length == 0) {","\t\t$(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim vnesite zahtevane podatke!</span>\");","\t} else {","\t\t$.ajaxSetup({","\t\t    headers: {\"Ehr-Session\": sessionId}","\t\t});","\t\t$.ajax({","\t\t    url: baseUrl + \"/ehr\",","\t\t    type: 'POST',","\t\t    success: function (data) {","\t\t        var ehrId = data.ehrId;","\t\t        var partyData = {","\t\t            firstNames: ime,","\t\t            lastNames: priimek,","\t\t            dateOfBirth: datumRojstva,","\t\t            partyAdditionalInfo: [{key: \"ehrId\", value: ehrId}]","\t\t        };","\t\t        $.ajax({","\t\t            url: baseUrl + \"/demographics/party\",","\t\t            type: 'POST',","\t\t            contentType: 'application/json',","\t\t            data: JSON.stringify(partyData),","\t\t            success: function (party) {","\t\t                if (party.action == 'CREATE') {","\t\t                    $(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>Uspešno kreirani EHR '\" + ehrId + \"'.</span>\");","\t\t                    console.log(\"Uspešno kreiran EHR '\" + ehrId + \"'.\");","\t\t                    $(\"#preberiEHRid\").val(ehrId);","\t\t\t\t\t\t\tehrIDs.push($(\"#preberiEHRid\").val(ehrId));","\t\t\t\t\t\t\t//$('#prikaziIbranegaBolnika').append('<option value=\"janez,novak,1938-10-11T14:58\">Janez Novak</option>');","\t\t\t\t\t\t\t//$('#prikaziIbranegaBolnika').html('<option value=\"janez,novak,1938-10-11T14:58\">Janez Novak</option>');","\t\t\t\t\t\t\t//$('#prikaziIbranegaBolnika').selec('refresh');","","\t\t                }","\t\t            },","\t\t            error: function(err) {","\t\t            \t$(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t            \tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t            }","\t\t        });","\t\t    }","\t\t});","\t}","}","","function preberiEHRodBolnika() {","\tsessionId = getSessionId();","","\tvar ehrId = $(\"#preberiEHRid\").val();","","\tif (!ehrId || ehrId.trim().length == 0) {","\t\t$(\"#preberiSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim vnesite zahtevan podatek!\");","\t} else {","\t\t$.ajax({","\t\t\turl: baseUrl + \"/demographics/ehr/\" + ehrId + \"/party\",","\t\t\ttype: 'GET',","\t\t\theaders: {\"Ehr-Session\": sessionId},","\t    \tsuccess: function (data) {","\t\t\t\tvar party = data.party;","\t\t\t\t$(\"#preberiSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>Bolnik '\" + party.firstNames + \" \" + party.lastNames + \"', ki se je rodil '\" + party.dateOfBirth + \"'.</span>\");","\t\t\t\tconsole.log(\"Bolnik '\" + party.firstNames + \" \" + party.lastNames + \"', ki se je rodil '\" + party.dateOfBirth + \"'.\");","\t\t\t},","\t\t\terror: function(err) {","\t\t\t\t$(\"#preberiSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t}","\t\t});","\t}\t","}","","function addVitalSignstoTestUsers (ehrID, ura, telVis, telTez, telTemp, sisTlak, diaTlak, oVKrvi, mer) {","\tsessionId = getSessionId();","","\tconsole.log(\"ehr ID: \" + ehrID);","","\t$.ajaxSetup({","\t\theaders: {\"Ehr-Session\": sessionId}","\t});","\tvar data = {","\t\t\"ctx/language\": \"en\",","\t\t\"ctx/territory\": \"SI\",","\t\t\"ctx/time\": ura,","\t\t\"vital_signs/height_length/any_event/body_height_length\": telVis,","\t\t\"vital_signs/body_weight/any_event/body_weight\": telTez,","\t\t\"vital_signs/body_temperature/any_event/temperature|magnitude\": telTemp,","\t\t\"vital_signs/body_temperature/any_event/temperature|unit\": \"°C\",","\t\t\"vital_signs/blood_pressure/any_event/systolic\": sisTlak,","\t\t\"vital_signs/blood_pressure/any_event/diastolic\": diaTlak,","\t\t\"vital_signs/indirect_oximetry:0/spo2|numerator\": oVKrvi","\t};","\tvar param = {","\t\t\"ehrId\": ehrID,","\t\ttemplateId: 'Vital Signs',","\t\tformat: 'FLAT',","\t\tcommitter: mer","\t};","\t$.ajax({","\t\turl: baseUrl + \"/composition?\" + $.param(param),","\t\ttype: 'POST',","\t\tcontentType: 'application/json',","\t\tdata: JSON.stringify(data),","\t\tsuccess: function (res) {","\t\t\tconsole.log(res.meta.href);","\t\t\t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>\" + res.meta.href + \".</span>\");","\t\t},","\t\terror: function(err) {","\t\t\t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t}","\t});","","","}","","function addWeight(ehrID, telTeza){","\tsessionId = getSessionId();","","\tconsole.log(\"add weight for: \" + ehrID );","","\t$.ajaxSetup({","\t\theaders: {\"Ehr-Session\": sessionId}","\t});","\tvar data = {","\t\t\"ctx/language\": \"en\",","\t\t\"ctx/territory\": \"SI\",","\t\t\"ctx/time\": \"2014-11-21T11:40Z\",","\t\t\"vital_signs/body_weight/any_event/body_weight\": telTeza","\t};","\tvar param = {","\t\t\"ehrId\": ehrID,","\t\ttemplateId: 'Vital Signs',","\t\tformat: 'FLAT',","\t\tcommitter: \"janez\"","\t};","\t$.ajax({","\t\turl: baseUrl + \"/composition?\" + $.param(param),","\t\ttype: 'POST',","\t\tcontentType: 'application/json',","\t\tdata: JSON.stringify(data),","\t\tsuccess: function (res) {","\t\t\tconsole.log(\"added weith for : \" + ehrID + \" teza: \" + telTeza);","\t\t\t//$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>\" + res.meta.href + \".</span>\");","\t\t},","\t\terror: function(err) {","\t\t\t//$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t}","\t});","}","","function dodajMeritveVitalnihZnakov() {","\tsessionId = getSessionId();","","\tvar ehrId = $(\"#dodajVitalnoEHR\").val();","\tvar datumInUra = $(\"#dodajVitalnoDatumInUra\").val();","\tvar telesnaVisina = $(\"#dodajVitalnoTelesnaVisina\").val();","\tvar telesnaTeza = $(\"#dodajVitalnoTelesnaTeza\").val();","\tvar telesnaTemperatura = $(\"#dodajVitalnoTelesnaTemperatura\").val();","\tvar sistolicniKrvniTlak = $(\"#dodajVitalnoKrvniTlakSistolicni\").val();","\tvar diastolicniKrvniTlak = $(\"#dodajVitalnoKrvniTlakDiastolicni\").val();","\tvar nasicenostKrviSKisikom = $(\"#dodajVitalnoNasicenostKrviSKisikom\").val();","\tvar merilec = $(\"#dodajVitalnoMerilec\").val();","","\tif (!ehrId || ehrId.trim().length == 0) {","\t\t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim vnesite zahtevane podatke!</span>\");","\t} else {","\t\t$.ajaxSetup({","\t\t    headers: {\"Ehr-Session\": sessionId}","\t\t});","\t\tvar podatki = {","\t\t\t// Preview Structure: https://rest.ehrscape.com/rest/v1/template/Vital%20Signs/example","\t\t    \"ctx/language\": \"en\",","\t\t    \"ctx/territory\": \"SI\",","\t\t    \"ctx/time\": datumInUra,","\t\t    \"vital_signs/height_length/any_event/body_height_length\": telesnaVisina,","\t\t    \"vital_signs/body_weight/any_event/body_weight\": telesnaTeza,","\t\t   \t\"vital_signs/body_temperature/any_event/temperature|magnitude\": telesnaTemperatura,","\t\t    \"vital_signs/body_temperature/any_event/temperature|unit\": \"°C\",","\t\t    \"vital_signs/blood_pressure/any_event/systolic\": sistolicniKrvniTlak,","\t\t    \"vital_signs/blood_pressure/any_event/diastolic\": diastolicniKrvniTlak,","\t\t    \"vital_signs/indirect_oximetry:0/spo2|numerator\": nasicenostKrviSKisikom","\t\t};","\t\tvar parametriZahteve = {","\t\t    \"ehrId\": ehrId,","\t\t    templateId: 'Vital Signs',","\t\t    format: 'FLAT',","\t\t    committer: merilec","\t\t};","\t\t$.ajax({","\t\t    url: baseUrl + \"/composition?\" + $.param(parametriZahteve),","\t\t    type: 'POST',","\t\t    contentType: 'application/json',","\t\t    data: JSON.stringify(podatki),","\t\t    success: function (res) {","\t\t    \tconsole.log(res.meta.href);","\t\t        $(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>\" + res.meta.href + \".</span>\");","\t\t    },","\t\t    error: function(err) {","\t\t    \t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t    }","\t\t});","\t}","}","","function showResults() {","\tsessionId = getSessionId();","","\tid = $(\"#prikaziIbranegaBolnika\").val();","","\tif(id == -1)","\t\t$(\"#noticePrikaziBolnika\").html(\"<span class='obvestiloBolnik label label-warning fade-in'> Izberi bolnika!\");","\telse {","\t\tvar ehrId = ehrIDs[id];","\t\tconsole.log(\"id: \" + id + \" klic showResults ehrId: \" + ehrId);","\t\tif(!ehrId) {","\t\t\t$(\"#noticePrikaziBolnika\").html(\"<span class='obvestiloBolnik label label-warning fade-in'> Dodaj testne uporabnike!\");","\t\t} else {","\t\t\t$(\"#noticePrikaziBolnika\").html(\"<span class='obvestiloBolnik label label-success fade-in'> Bolnik najden\");","","\t\t\tvar jqXHR = $.ajax({","\t\t\t\turl: baseUrl + \"/demographics/ehr/\" + ehrId + \"/party\",","\t\t\t\ttype: 'GET',","\t\t\t\theaders: {\"Ehr-Session\": sessionId},","\t\t\t\tsuccess: function(data) {","\t\t\t\t\tvar parti = data.party;","\t\t\t\t\t$(\"#informacijeObolniku\").html(\"<span>Bolnik: <b>\" + parti.firstNames + \" \" + parti.lastNames + \"</b></span>\");","","\t\t\t\t\t$.ajax({","\t\t\t\t\t\turl: baseUrl + \"/view/\" + ehrId + \"/\" + \"weight\",","\t\t\t\t\t\ttype: 'GET',","\t\t\t\t\t\theaders: {\"Ehr-Session\": sessionId},","\t\t\t\t\t\tasync: false,","\t\t\t\t\t\tsuccess: function(res) {","\t\t\t\t\t\t\tif (res.length > 0) {","\t\t\t\t\t\t\t\tfor (i = 0; i<res.length; i++) {","\t\t\t\t\t\t\t\t\tvar teza = {letter: i+1, frequency: res[i].weight};","\t\t\t\t\t\t\t\t\tgraphData[i] = teza;","\t\t\t\t\t\t\t\t\tconsole.log(graphData[i].letter + \" \" + graphData[i].frequency);","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t})","\t\t\t\t}","","","\t\t\t})","","","","\t\t}","","\t}","","\tjqXHR.done(function(){","\t\tcreateGraph();","\t});","}","","function preberiMeritveVitalnihZnakov() {","\tsessionId = getSessionId();\t","","\tvar ehrId = ehrIDs[$(\"#meritveVitalnihZnakovEHRid\").val()];","\tvar tip = $(\"#preberiTipZaVitalneZnake\").val();","","\tif (!ehrId || ehrId.trim().length == 0 || !tip || tip.trim().length == 0) {","\t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim vnesite zahtevan podatek!\");","\t} else {","\t\t$.ajax({","\t\t\turl: baseUrl + \"/demographics/ehr/\" + ehrId + \"/party\",","\t    \ttype: 'GET',","\t    \theaders: {\"Ehr-Session\": sessionId},","\t    \tsuccess: function (data) {","\t\t\t\tvar party = data.party;","\t\t\t\t$(\"#rezultatMeritveVitalnihZnakov\").html(\"<br/><span>Pridobivanje podatkov za <b>'\" + tip + \"'</b> bolnika <b>'\" + party.firstNames + \" \" + party.lastNames + \"'</b>.</span><br/><br/>\");","\t\t\t\tif (tip == \"telesna temperatura\") {","\t\t\t\t\t$.ajax({","\t\t\t\t\t    url: baseUrl + \"/view/\" + ehrId + \"/\" + \"body_temperature\",","\t\t\t\t\t    type: 'GET',","\t\t\t\t\t    headers: {\"Ehr-Session\": sessionId},","\t\t\t\t\t    success: function (res) {","\t\t\t\t\t    \tif (res.length > 0) {","\t\t\t\t\t\t    \tvar results = \"<table class='table table-striped table-hover'><tr><th>Datum in ura</th><th class='text-right'>Telesna temperatura</th></tr>\";","\t\t\t\t\t\t        for (var i in res) {","\t\t\t\t\t\t            results += \"<tr><td>\" + res[i].time + \"</td><td class='text-right'>\" + res[i].temperature + \" \" \t+ res[i].unit + \"</td>\";","\t\t\t\t\t\t        }","\t\t\t\t\t\t        results += \"</table>\";","\t\t\t\t\t\t        $(\"#rezultatMeritveVitalnihZnakov\").append(results);","\t\t\t\t\t    \t} else {","\t\t\t\t\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");","\t\t\t\t\t    \t}","\t\t\t\t\t    },","\t\t\t\t\t    error: function() {","\t\t\t\t\t    \t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t\t\t    }","\t\t\t\t\t});","\t\t\t\t} else if (tip == \"telesna teža\") {","\t\t\t\t\t$.ajax({","\t\t\t\t\t    url: baseUrl + \"/view/\" + ehrId + \"/\" + \"weight\",","\t\t\t\t\t    type: 'GET',","\t\t\t\t\t    headers: {\"Ehr-Session\": sessionId},","\t\t\t\t\t    success: function (res) {","\t\t\t\t\t    \tif (res.length > 0) {","\t\t\t\t\t\t    \tvar results = \"<table class='table table-striped table-hover'><tr><th>Datum in ura</th><th class='text-right'>Telesna teža</th></tr>\";","\t\t\t\t\t\t        for (var i in res) {","\t\t\t\t\t\t            results += \"<tr><td>\" + res[i].time + \"</td><td class='text-right'>\" + res[i].weight + \" \" \t+ res[i].unit + \"</td>\";","\t\t\t\t\t\t        }","\t\t\t\t\t\t        results += \"</table>\";","\t\t\t\t\t\t        $(\"#rezultatMeritveVitalnihZnakov\").append(results);","\t\t\t\t\t    \t} else {","\t\t\t\t\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");","\t\t\t\t\t    \t}","\t\t\t\t\t    },","\t\t\t\t\t    error: function() {","\t\t\t\t\t    \t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t\t\t    }","\t\t\t\t\t});\t\t\t\t\t","\t\t\t\t} else if (tip == \"telesna temperatura AQL\") {","\t\t\t\t\tvar AQL = ","\t\t\t\t\t\t\"select \" +","    \t\t\t\t\t\t\"t/data[at0002]/events[at0003]/time/value as cas, \" +","    \t\t\t\t\t\t\"t/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/magnitude as temperatura_vrednost, \" +","    \t\t\t\t\t\t\"t/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/units as temperatura_enota \" +","\t\t\t\t\t\t\"from EHR e[e/ehr_id/value='\" + ehrId + \"'] \" +","\t\t\t\t\t\t\"contains OBSERVATION t[openEHR-EHR-OBSERVATION.body_temperature.v1] \" +","\t\t\t\t\t\t\"where t/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/magnitude<35 \" +","\t\t\t\t\t\t\"order by t/data[at0002]/events[at0003]/time/value desc \" +","\t\t\t\t\t\t\"limit 10\";","\t\t\t\t\t$.ajax({","\t\t\t\t\t    url: baseUrl + \"/query?\" + $.param({\"aql\": AQL}),","\t\t\t\t\t    type: 'GET',","\t\t\t\t\t    headers: {\"Ehr-Session\": sessionId},","\t\t\t\t\t    success: function (res) {","\t\t\t\t\t    \tvar results = \"<table class='table table-striped table-hover'><tr><th>Datum in ura</th><th class='text-right'>Telesna temperatura</th></tr>\";","\t\t\t\t\t    \tif (res) {","\t\t\t\t\t    \t\tvar rows = res.resultSet;","\t\t\t\t\t\t        for (var i in rows) {","\t\t\t\t\t\t            results += \"<tr><td>\" + rows[i].cas + \"</td><td class='text-right'>\" + rows[i].temperatura_vrednost + \" \" \t+ rows[i].temperatura_enota + \"</td>\";","\t\t\t\t\t\t        }","\t\t\t\t\t\t        results += \"</table>\";","\t\t\t\t\t\t        $(\"#rezultatMeritveVitalnihZnakov\").append(results);","\t\t\t\t\t    \t} else {","\t\t\t\t\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");","\t\t\t\t\t    \t}","","\t\t\t\t\t    },","\t\t\t\t\t    error: function() {","\t\t\t\t\t    \t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t\t\t    }","\t\t\t\t\t});","\t\t\t\t}","\t    \t},","\t    \terror: function(err) {","\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t    \t}","\t\t});","\t}","}","","$(document).ready(function() {","\t$('#preberiObstojeciEHR').change(function() {","\t\t$(\"#preberiSporocilo\").html(\"\");","\t\t$(\"#preberiEHRid\").val($(this).val());","\t});","\t$('#preberiPredlogoBolnika').change(function() {","\t\t$(\"#kreirajSporocilo\").html(\"\");","\t\tvar podatki = $(this).val().split(\",\");","\t\t$(\"#kreirajIme\").val(podatki[0]);","\t\t$(\"#kreirajPriimek\").val(podatki[1]);","\t\t$(\"#kreirajDatumRojstva\").val(podatki[2]);","\t});","\t$('#preberiObstojeciVitalniZnak').change(function() {","\t\t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"\");","\t\tvar podatki = $(this).val().split(\"|\");","\t\t$(\"#dodajVitalnoEHR\").val(podatki[0]);","\t\t$(\"#dodajVitalnoDatumInUra\").val(podatki[1]);","\t\t$(\"#dodajVitalnoTelesnaVisina\").val(podatki[2]);","\t\t$(\"#dodajVitalnoTelesnaTeza\").val(podatki[3]);","\t\t$(\"#dodajVitalnoTelesnaTemperatura\").val(podatki[4]);","\t\t$(\"#dodajVitalnoKrvniTlakSistolicni\").val(podatki[5]);","\t\t$(\"#dodajVitalnoKrvniTlakDiastolicni\").val(podatki[6]);","\t\t$(\"#dodajVitalnoNasicenostKrviSKisikom\").val(podatki[7]);","\t\t$(\"#dodajVitalnoMerilec\").val(podatki[8]);","\t});","\t$('#preberiEhrIdZaVitalneZnake').change(function() {","\t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"\");","\t\t$(\"#rezultatMeritveVitalnihZnakov\").html(\"\");","\t\t$(\"#meritveVitalnihZnakovEHRid\").val($(this).val());","\t});","});"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":568,"column":3},"action":"remove","lines":["","","var baseUrl = 'https://rest.ehrscape.com/rest/v1';","var queryUrl = baseUrl + '/query';","","var username = \"ois.seminar\";","var password = \"ois4fri\";","","var graphData = [ ];","","var ehrIDs = [ ];","","function getSessionId() {","    var response = $.ajax({","        type: \"POST\",","        url: baseUrl + \"/session?username=\" + encodeURIComponent(username) +","                \"&password=\" + encodeURIComponent(password),","        async: false","    });","    return response.responseJSON.sessionId;","}","","function runCreateUsers() {","\tsessionId = getSessionId();","","\t$.when(createTestUsers(\"janez\", \"novak\", \"1938-10-11T14:58\"), createTestUsers(\"marko\", \"testni\", \"1993-11-30T11:11\"), createTestUsers(\"jure\", \"medved\", \"1993-07-22T15:26\")).done(function(){","\t\taddVitalSignstoTestUsers(ehrIDs[0], \"2014-12-19T12:20Z\", 183, 85, 36.55, 122, 95, 100, \"test\");","\t\taddVitalSignstoTestUsers(ehrIDs[1], \"2014-10-22T22:30Z\", 190, 90, 37.55, 115, 90, 95, \"test2\");","\t\taddVitalSignstoTestUsers(ehrIDs[2], \"2014-11-05T15:12Z\", 175, 65, 36.20, 115, 90, 105, \"test4\");","\t\tfor(i=0; i<3; i++) {","\t\t\tfor(j=0; j<7; j++) {","\t\t\t\tswitch (i) {","\t\t\t\t\tcase 0:","\t\t\t\t\t\tweight = (Math.random() * 10 + 78).toFixed(1);","\t\t\t\t\t\taddWeight(ehrIDs[i], weight);","\t\t\t\t\t\tbreak;","\t\t\t\t\tcase 1:","\t\t\t\t\t\tweight = (Math.random() * 11 + 85).toFixed(1);","\t\t\t\t\t\taddWeight(ehrIDs[i], weight);","\t\t\t\t\t\tbreak;","\t\t\t\t\tcase 2:","\t\t\t\t\t\tweight = (Math.random() * 12 + 60).toFixed(1);","\t\t\t\t\t\taddWeight(ehrIDs[i], weight);","\t\t\t\t\t\tbreak;","\t\t\t\t}","\t\t\t}","\t\t}","\t});","","\t//createGraph();","","}","","function createGraph() {","\tvar margin = {top: 40, right: 20, bottom: 30, left: 40},","\t\twidth = screen.width/2 - 60 - margin.left - margin.right,","\t\theight = 500 - margin.top - margin.bottom;","","\tvar x = d3.scale.ordinal()","\t\t.rangeRoundBands([0, width], .1);","","\tvar y = d3.scale.linear()","\t\t.range([height, 0]);","\t\t//.range([0, 100])","","\tvar xAxis = d3.svg.axis()","\t\t.scale(x)","\t\t.orient(\"bottom\");","","\tvar yAxis = d3.svg.axis()","\t\t.scale(y)","\t\t.orient(\"left\")","\t\t//.range([0, 100])","\t\t//.tickFormat(formatPercent);","","\tvar tip = d3.tip()","\t\t.attr('class', 'd3-tip')","\t\t.offset([-10, 0])","\t\t.html(function(d) {","\t\t\treturn \"<strong>Teza:</strong> <span style='color:Green'>\" + d.frequency + \"</span>\";","\t\t})","","\tvar svg = d3.select(\"#graphWeight\").append(\"svg\")","\t\t.attr(\"width\", width + margin.left + margin.right)","\t\t.attr(\"height\", height + margin.top + margin.bottom)","\t\t.append(\"g\")","\t\t.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");","","\tsvg.call(tip);","","\t\tx.domain(graphData.map(function(d) { return d.letter; }));","\t\ty.domain([0, d3.max(graphData, function(d) { return d.frequency; })]);","","\t\tsvg.append(\"g\")","\t\t\t.attr(\"class\", \"x axis\")","\t\t\t.attr(\"transform\", \"translate(0,\" + height + \")\")","\t\t\t.call(xAxis);","","\t\tsvg.append(\"g\")","\t\t\t.attr(\"class\", \"y axis\")","\t\t\t.call(yAxis)","\t\t\t.append(\"text\")","\t\t\t//.attr(\"transform\", \"rotate(-90)\")","\t\t\t.attr(\"y\", -20)","\t\t\t.attr(\"dy\", \".71em\")","\t\t\t//.style(\"text-anchor\", \"end\")","\t\t\t.text(\"Teza\");","","\t\tsvg.selectAll(\".bar\")","\t\t\t.data(graphData)","\t\t\t.enter().append(\"rect\")","\t\t\t.attr(\"class\", \"bar\")","\t\t\t.attr(\"x\", function(d) { return x(d.letter); })","\t\t\t.attr(\"width\", x.rangeBand())","\t\t\t.attr(\"y\", function(d) { return y(d.frequency); })","\t\t\t.attr(\"height\", function(d) { return height - y(d.frequency); })","\t\t\t.on('mouseover', tip.show)","\t\t\t.on('mouseout', tip.hide)","","","","\tfunction type(d) {","\t\td.frequency = +d.frequency;","\t\treturn d;","\t}","}","","function createTestUsers(ime, priimek, datumRojstva) {","\tsessionId = getSessionId();","","\t$.ajaxSetup({","\t\theaders: {\"Ehr-Session\": sessionId}","\t});","\t$.ajax({","\t\turl: baseUrl + \"/ehr\",","\t\ttype: 'POST',","\t\tasync: false,","\t\tsuccess: function (data) {","\t\t\tvar ehrId = data.ehrId;","\t\t\tvar partyData = {","\t\t\t\tfirstNames: ime,","\t\t\t\tlastNames: priimek,","\t\t\t\tdateOfBirth: datumRojstva,","\t\t\t\tpartyAdditionalInfo: [{key: \"ehrId\", value: ehrId}]","\t\t\t};","\t\t\treturn $.ajax({","\t\t\t\turl: baseUrl + \"/demographics/party\",","\t\t\t\ttype: 'POST',","\t\t\t\tasync: false,","\t\t\t\tcontentType: 'application/json',","\t\t\t\tdata: JSON.stringify(partyData),","\t\t\t\tsuccess: function (party) {","\t\t\t\t\tif (party.action == 'CREATE') {","\t\t\t\t\t\t$(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>Uspešno kreirani EHR zapisi</span>\");","\t\t\t\t\t\t//console.log(\"Uspešno kreiran EHR zapis \" + ehrId + \"'.\");","\t\t\t\t\t\tehrIDs[ehrIDs.length] = ehrId;","\t\t\t\t\t\tconsole.log(ehrIDs[ehrIDs.length-1]);","\t\t\t\t\t}","\t\t\t\t},","\t\t\t\terror: function(err) {","\t\t\t\t\t//$(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t\t}","\t\t\t});","\t\t}","\t});","","}","","function kreirajEHRzaBolnika() {","\tsessionId = getSessionId();","","\tvar ime = $(\"#kreirajIme\").val();","\tvar priimek = $(\"#kreirajPriimek\").val();","\tvar datumRojstva = $(\"#kreirajDatumRojstva\").val();","","\tif (!ime || !priimek || !datumRojstva || ime.trim().length == 0 || priimek.trim().length == 0 || datumRojstva.trim().length == 0) {","\t\t$(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim vnesite zahtevane podatke!</span>\");","\t} else {","\t\t$.ajaxSetup({","\t\t    headers: {\"Ehr-Session\": sessionId}","\t\t});","\t\t$.ajax({","\t\t    url: baseUrl + \"/ehr\",","\t\t    type: 'POST',","\t\t    success: function (data) {","\t\t        var ehrId = data.ehrId;","\t\t        var partyData = {","\t\t            firstNames: ime,","\t\t            lastNames: priimek,","\t\t            dateOfBirth: datumRojstva,","\t\t            partyAdditionalInfo: [{key: \"ehrId\", value: ehrId}]","\t\t        };","\t\t        $.ajax({","\t\t            url: baseUrl + \"/demographics/party\",","\t\t            type: 'POST',","\t\t            contentType: 'application/json',","\t\t            data: JSON.stringify(partyData),","\t\t            success: function (party) {","\t\t                if (party.action == 'CREATE') {","\t\t                    $(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>Uspešno kreirani EHR '\" + ehrId + \"'.</span>\");","\t\t                    console.log(\"Uspešno kreiran EHR '\" + ehrId + \"'.\");","\t\t                    $(\"#preberiEHRid\").val(ehrId);","\t\t\t\t\t\t\tehrIDs.push($(\"#preberiEHRid\").val(ehrId));","\t\t\t\t\t\t\t//$('#prikaziIbranegaBolnika').append('<option value=\"janez,novak,1938-10-11T14:58\">Janez Novak</option>');","\t\t\t\t\t\t\t//$('#prikaziIbranegaBolnika').html('<option value=\"janez,novak,1938-10-11T14:58\">Janez Novak</option>');","\t\t\t\t\t\t\t//$('#prikaziIbranegaBolnika').selec('refresh');","","\t\t                }","\t\t            },","\t\t            error: function(err) {","\t\t            \t$(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t            \tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t            }","\t\t        });","\t\t    }","\t\t});","\t}","}","","function preberiEHRodBolnika() {","\tsessionId = getSessionId();","","\tvar ehrId = $(\"#preberiEHRid\").val();","","\tif (!ehrId || ehrId.trim().length == 0) {","\t\t$(\"#preberiSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim vnesite zahtevan podatek!\");","\t} else {","\t\t$.ajax({","\t\t\turl: baseUrl + \"/demographics/ehr/\" + ehrId + \"/party\",","\t\t\ttype: 'GET',","\t\t\theaders: {\"Ehr-Session\": sessionId},","\t    \tsuccess: function (data) {","\t\t\t\tvar party = data.party;","\t\t\t\t$(\"#preberiSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>Bolnik '\" + party.firstNames + \" \" + party.lastNames + \"', ki se je rodil '\" + party.dateOfBirth + \"'.</span>\");","\t\t\t\tconsole.log(\"Bolnik '\" + party.firstNames + \" \" + party.lastNames + \"', ki se je rodil '\" + party.dateOfBirth + \"'.\");","\t\t\t},","\t\t\terror: function(err) {","\t\t\t\t$(\"#preberiSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t}","\t\t});","\t}\t","}","","function addVitalSignstoTestUsers (ehrID, ura, telVis, telTez, telTemp, sisTlak, diaTlak, oVKrvi, mer) {","\tsessionId = getSessionId();","","\tconsole.log(\"ehr ID: \" + ehrID);","","\t$.ajaxSetup({","\t\theaders: {\"Ehr-Session\": sessionId}","\t});","\tvar data = {","\t\t\"ctx/language\": \"en\",","\t\t\"ctx/territory\": \"SI\",","\t\t\"ctx/time\": ura,","\t\t\"vital_signs/height_length/any_event/body_height_length\": telVis,","\t\t\"vital_signs/body_weight/any_event/body_weight\": telTez,","\t\t\"vital_signs/body_temperature/any_event/temperature|magnitude\": telTemp,","\t\t\"vital_signs/body_temperature/any_event/temperature|unit\": \"°C\",","\t\t\"vital_signs/blood_pressure/any_event/systolic\": sisTlak,","\t\t\"vital_signs/blood_pressure/any_event/diastolic\": diaTlak,","\t\t\"vital_signs/indirect_oximetry:0/spo2|numerator\": oVKrvi","\t};","\tvar param = {","\t\t\"ehrId\": ehrID,","\t\ttemplateId: 'Vital Signs',","\t\tformat: 'FLAT',","\t\tcommitter: mer","\t};","\t$.ajax({","\t\turl: baseUrl + \"/composition?\" + $.param(param),","\t\ttype: 'POST',","\t\tcontentType: 'application/json',","\t\tdata: JSON.stringify(data),","\t\tsuccess: function (res) {","\t\t\tconsole.log(res.meta.href);","\t\t\t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>\" + res.meta.href + \".</span>\");","\t\t},","\t\terror: function(err) {","\t\t\t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t}","\t});","","","}","","function addWeight(ehrID, telTeza){","\tsessionId = getSessionId();","","\tconsole.log(\"add weight for: \" + ehrID );","","\t$.ajaxSetup({","\t\theaders: {\"Ehr-Session\": sessionId}","\t});","\tvar data = {","\t\t\"ctx/language\": \"en\",","\t\t\"ctx/territory\": \"SI\",","\t\t\"ctx/time\": \"2014-11-21T11:40Z\",","\t\t\"vital_signs/body_weight/any_event/body_weight\": telTeza","\t};","\tvar param = {","\t\t\"ehrId\": ehrID,","\t\ttemplateId: 'Vital Signs',","\t\tformat: 'FLAT',","\t\tcommitter: \"janez\"","\t};","\t$.ajax({","\t\turl: baseUrl + \"/composition?\" + $.param(param),","\t\ttype: 'POST',","\t\tcontentType: 'application/json',","\t\tdata: JSON.stringify(data),","\t\tsuccess: function (res) {","\t\t\tconsole.log(\"added weith for : \" + ehrID + \" teza: \" + telTeza);","\t\t\t//$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>\" + res.meta.href + \".</span>\");","\t\t},","\t\terror: function(err) {","\t\t\t//$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t}","\t});","}","","function dodajMeritveVitalnihZnakov() {","\tsessionId = getSessionId();","","\tvar ehrId = $(\"#dodajVitalnoEHR\").val();","\tvar datumInUra = $(\"#dodajVitalnoDatumInUra\").val();","\tvar telesnaVisina = $(\"#dodajVitalnoTelesnaVisina\").val();","\tvar telesnaTeza = $(\"#dodajVitalnoTelesnaTeza\").val();","\tvar telesnaTemperatura = $(\"#dodajVitalnoTelesnaTemperatura\").val();","\tvar sistolicniKrvniTlak = $(\"#dodajVitalnoKrvniTlakSistolicni\").val();","\tvar diastolicniKrvniTlak = $(\"#dodajVitalnoKrvniTlakDiastolicni\").val();","\tvar nasicenostKrviSKisikom = $(\"#dodajVitalnoNasicenostKrviSKisikom\").val();","\tvar merilec = $(\"#dodajVitalnoMerilec\").val();","","\tif (!ehrId || ehrId.trim().length == 0) {","\t\t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim vnesite zahtevane podatke!</span>\");","\t} else {","\t\t$.ajaxSetup({","\t\t    headers: {\"Ehr-Session\": sessionId}","\t\t});","\t\tvar podatki = {","\t\t\t// Preview Structure: https://rest.ehrscape.com/rest/v1/template/Vital%20Signs/example","\t\t    \"ctx/language\": \"en\",","\t\t    \"ctx/territory\": \"SI\",","\t\t    \"ctx/time\": datumInUra,","\t\t    \"vital_signs/height_length/any_event/body_height_length\": telesnaVisina,","\t\t    \"vital_signs/body_weight/any_event/body_weight\": telesnaTeza,","\t\t   \t\"vital_signs/body_temperature/any_event/temperature|magnitude\": telesnaTemperatura,","\t\t    \"vital_signs/body_temperature/any_event/temperature|unit\": \"°C\",","\t\t    \"vital_signs/blood_pressure/any_event/systolic\": sistolicniKrvniTlak,","\t\t    \"vital_signs/blood_pressure/any_event/diastolic\": diastolicniKrvniTlak,","\t\t    \"vital_signs/indirect_oximetry:0/spo2|numerator\": nasicenostKrviSKisikom","\t\t};","\t\tvar parametriZahteve = {","\t\t    \"ehrId\": ehrId,","\t\t    templateId: 'Vital Signs',","\t\t    format: 'FLAT',","\t\t    committer: merilec","\t\t};","\t\t$.ajax({","\t\t    url: baseUrl + \"/composition?\" + $.param(parametriZahteve),","\t\t    type: 'POST',","\t\t    contentType: 'application/json',","\t\t    data: JSON.stringify(podatki),","\t\t    success: function (res) {","\t\t    \tconsole.log(res.meta.href);","\t\t        $(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>\" + res.meta.href + \".</span>\");","\t\t    },","\t\t    error: function(err) {","\t\t    \t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t    }","\t\t});","\t}","}","","function showResults() {","\tsessionId = getSessionId();","","\tid = $(\"#prikaziIbranegaBolnika\").val();","","\tif(id == -1)","\t\t$(\"#noticePrikaziBolnika\").html(\"<span class='obvestiloBolnik label label-warning fade-in'> Izberi bolnika!\");","\telse {","\t\tvar ehrId = ehrIDs[id];","\t\tconsole.log(\"id: \" + id + \" klic showResults ehrId: \" + ehrId);","\t\tif(!ehrId) {","\t\t\t$(\"#noticePrikaziBolnika\").html(\"<span class='obvestiloBolnik label label-warning fade-in'> Dodaj testne uporabnike!\");","\t\t} else {","\t\t\t$(\"#noticePrikaziBolnika\").html(\"<span class='obvestiloBolnik label label-success fade-in'> Bolnik najden\");","","\t\t\tvar jqXHR = $.ajax({","\t\t\t\turl: baseUrl + \"/demographics/ehr/\" + ehrId + \"/party\",","\t\t\t\ttype: 'GET',","\t\t\t\theaders: {\"Ehr-Session\": sessionId},","\t\t\t\tsuccess: function(data) {","\t\t\t\t\tvar parti = data.party;","\t\t\t\t\t$(\"#informacijeObolniku\").html(\"<span>Bolnik: <b>\" + parti.firstNames + \" \" + parti.lastNames + \"</b></span>\");","","\t\t\t\t\t$.ajax({","\t\t\t\t\t\turl: baseUrl + \"/view/\" + ehrId + \"/\" + \"weight\",","\t\t\t\t\t\ttype: 'GET',","\t\t\t\t\t\theaders: {\"Ehr-Session\": sessionId},","\t\t\t\t\t\tasync: false,","\t\t\t\t\t\tsuccess: function(res) {","\t\t\t\t\t\t\tif (res.length > 0) {","\t\t\t\t\t\t\t\tfor (i = 0; i<res.length; i++) {","\t\t\t\t\t\t\t\t\tvar teza = {letter: i+1, frequency: res[i].weight};","\t\t\t\t\t\t\t\t\tgraphData[i] = teza;","\t\t\t\t\t\t\t\t\tconsole.log(graphData[i].letter + \" \" + graphData[i].frequency);","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t})","\t\t\t\t}","","","\t\t\t})","","","","\t\t}","","\t}","","\tjqXHR.done(function(){","\t\tcreateGraph();","\t});","}","","function preberiMeritveVitalnihZnakov() {","\tsessionId = getSessionId();\t","","\tvar ehrId = ehrIDs[$(\"#meritveVitalnihZnakovEHRid\").val()];","\tvar tip = $(\"#preberiTipZaVitalneZnake\").val();","","\tif (!ehrId || ehrId.trim().length == 0 || !tip || tip.trim().length == 0) {","\t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim vnesite zahtevan podatek!\");","\t} else {","\t\t$.ajax({","\t\t\turl: baseUrl + \"/demographics/ehr/\" + ehrId + \"/party\",","\t    \ttype: 'GET',","\t    \theaders: {\"Ehr-Session\": sessionId},","\t    \tsuccess: function (data) {","\t\t\t\tvar party = data.party;","\t\t\t\t$(\"#rezultatMeritveVitalnihZnakov\").html(\"<br/><span>Pridobivanje podatkov za <b>'\" + tip + \"'</b> bolnika <b>'\" + party.firstNames + \" \" + party.lastNames + \"'</b>.</span><br/><br/>\");","\t\t\t\tif (tip == \"telesna temperatura\") {","\t\t\t\t\t$.ajax({","\t\t\t\t\t    url: baseUrl + \"/view/\" + ehrId + \"/\" + \"body_temperature\",","\t\t\t\t\t    type: 'GET',","\t\t\t\t\t    headers: {\"Ehr-Session\": sessionId},","\t\t\t\t\t    success: function (res) {","\t\t\t\t\t    \tif (res.length > 0) {","\t\t\t\t\t\t    \tvar results = \"<table class='table table-striped table-hover'><tr><th>Datum in ura</th><th class='text-right'>Telesna temperatura</th></tr>\";","\t\t\t\t\t\t        for (var i in res) {","\t\t\t\t\t\t            results += \"<tr><td>\" + res[i].time + \"</td><td class='text-right'>\" + res[i].temperature + \" \" \t+ res[i].unit + \"</td>\";","\t\t\t\t\t\t        }","\t\t\t\t\t\t        results += \"</table>\";","\t\t\t\t\t\t        $(\"#rezultatMeritveVitalnihZnakov\").append(results);","\t\t\t\t\t    \t} else {","\t\t\t\t\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");","\t\t\t\t\t    \t}","\t\t\t\t\t    },","\t\t\t\t\t    error: function() {","\t\t\t\t\t    \t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t\t\t    }","\t\t\t\t\t});","\t\t\t\t} else if (tip == \"telesna teža\") {","\t\t\t\t\t$.ajax({","\t\t\t\t\t    url: baseUrl + \"/view/\" + ehrId + \"/\" + \"weight\",","\t\t\t\t\t    type: 'GET',","\t\t\t\t\t    headers: {\"Ehr-Session\": sessionId},","\t\t\t\t\t    success: function (res) {","\t\t\t\t\t    \tif (res.length > 0) {","\t\t\t\t\t\t    \tvar results = \"<table class='table table-striped table-hover'><tr><th>Datum in ura</th><th class='text-right'>Telesna teža</th></tr>\";","\t\t\t\t\t\t        for (var i in res) {","\t\t\t\t\t\t            results += \"<tr><td>\" + res[i].time + \"</td><td class='text-right'>\" + res[i].weight + \" \" \t+ res[i].unit + \"</td>\";","\t\t\t\t\t\t        }","\t\t\t\t\t\t        results += \"</table>\";","\t\t\t\t\t\t        $(\"#rezultatMeritveVitalnihZnakov\").append(results);","\t\t\t\t\t    \t} else {","\t\t\t\t\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");","\t\t\t\t\t    \t}","\t\t\t\t\t    },","\t\t\t\t\t    error: function() {","\t\t\t\t\t    \t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t\t\t    }","\t\t\t\t\t});\t\t\t\t\t","\t\t\t\t} else if (tip == \"telesna temperatura AQL\") {","\t\t\t\t\tvar AQL = ","\t\t\t\t\t\t\"select \" +","    \t\t\t\t\t\t\"t/data[at0002]/events[at0003]/time/value as cas, \" +","    \t\t\t\t\t\t\"t/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/magnitude as temperatura_vrednost, \" +","    \t\t\t\t\t\t\"t/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/units as temperatura_enota \" +","\t\t\t\t\t\t\"from EHR e[e/ehr_id/value='\" + ehrId + \"'] \" +","\t\t\t\t\t\t\"contains OBSERVATION t[openEHR-EHR-OBSERVATION.body_temperature.v1] \" +","\t\t\t\t\t\t\"where t/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/magnitude<35 \" +","\t\t\t\t\t\t\"order by t/data[at0002]/events[at0003]/time/value desc \" +","\t\t\t\t\t\t\"limit 10\";","\t\t\t\t\t$.ajax({","\t\t\t\t\t    url: baseUrl + \"/query?\" + $.param({\"aql\": AQL}),","\t\t\t\t\t    type: 'GET',","\t\t\t\t\t    headers: {\"Ehr-Session\": sessionId},","\t\t\t\t\t    success: function (res) {","\t\t\t\t\t    \tvar results = \"<table class='table table-striped table-hover'><tr><th>Datum in ura</th><th class='text-right'>Telesna temperatura</th></tr>\";","\t\t\t\t\t    \tif (res) {","\t\t\t\t\t    \t\tvar rows = res.resultSet;","\t\t\t\t\t\t        for (var i in rows) {","\t\t\t\t\t\t            results += \"<tr><td>\" + rows[i].cas + \"</td><td class='text-right'>\" + rows[i].temperatura_vrednost + \" \" \t+ rows[i].temperatura_enota + \"</td>\";","\t\t\t\t\t\t        }","\t\t\t\t\t\t        results += \"</table>\";","\t\t\t\t\t\t        $(\"#rezultatMeritveVitalnihZnakov\").append(results);","\t\t\t\t\t    \t} else {","\t\t\t\t\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");","\t\t\t\t\t    \t}","","\t\t\t\t\t    },","\t\t\t\t\t    error: function() {","\t\t\t\t\t    \t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t\t\t    }","\t\t\t\t\t});","\t\t\t\t}","\t    \t},","\t    \terror: function(err) {","\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t    \t}","\t\t});","\t}","}","","$(document).ready(function() {","\t$('#preberiObstojeciEHR').change(function() {","\t\t$(\"#preberiSporocilo\").html(\"\");","\t\t$(\"#preberiEHRid\").val($(this).val());","\t});","\t$('#preberiPredlogoBolnika').change(function() {","\t\t$(\"#kreirajSporocilo\").html(\"\");","\t\tvar podatki = $(this).val().split(\",\");","\t\t$(\"#kreirajIme\").val(podatki[0]);","\t\t$(\"#kreirajPriimek\").val(podatki[1]);","\t\t$(\"#kreirajDatumRojstva\").val(podatki[2]);","\t});","\t$('#preberiObstojeciVitalniZnak').change(function() {","\t\t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"\");","\t\tvar podatki = $(this).val().split(\"|\");","\t\t$(\"#dodajVitalnoEHR\").val(podatki[0]);","\t\t$(\"#dodajVitalnoDatumInUra\").val(podatki[1]);","\t\t$(\"#dodajVitalnoTelesnaVisina\").val(podatki[2]);","\t\t$(\"#dodajVitalnoTelesnaTeza\").val(podatki[3]);","\t\t$(\"#dodajVitalnoTelesnaTemperatura\").val(podatki[4]);","\t\t$(\"#dodajVitalnoKrvniTlakSistolicni\").val(podatki[5]);","\t\t$(\"#dodajVitalnoKrvniTlakDiastolicni\").val(podatki[6]);","\t\t$(\"#dodajVitalnoNasicenostKrviSKisikom\").val(podatki[7]);","\t\t$(\"#dodajVitalnoMerilec\").val(podatki[8]);","\t});","\t$('#preberiEhrIdZaVitalneZnake').change(function() {","\t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"\");","\t\t$(\"#rezultatMeritveVitalnihZnakov\").html(\"\");","\t\t$(\"#meritveVitalnihZnakovEHRid\").val($(this).val());","\t});","});"]}]}],[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":456,"column":1},"action":"insert","lines":["var baseUrl = 'https://rest.ehrscape.com/rest/v1';","var queryUrl = baseUrl + '/query';","","var username = \"ois.seminar\";","var password = \"ois4fri\";","","function getSessionId() {","    var response = $.ajax({","        type: \"POST\",","        url: baseUrl + \"/session?username=\" + encodeURIComponent(username) +","                \"&password=\" + encodeURIComponent(password),","        async: false","    });","    return response.responseJSON.sessionId;","}","","var uporabniki [] ; ","","function kreirajEHRzaBolnika() {","\tsessionId = getSessionId();","","\tvar ime = $(\"#kreirajIme\").val();","\tvar priimek = $(\"#kreirajPriimek\").val();","\tvar datumRojstva = $(\"#kreirajDatumRojstva\").val();","","\tif (!ime || !priimek || !datumRojstva || ime.trim().length == 0 || priimek.trim().length == 0 || datumRojstva.trim().length == 0) {","\t\t$(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim vnesite zahtevane podatke!</span>\");","\t} else {","\t\t$.ajaxSetup({","\t\t    headers: {\"Ehr-Session\": sessionId}","\t\t});","\t\t$.ajax({","\t\t    url: baseUrl + \"/ehr\",","\t\t    type: 'POST',","\t\t    success: function (data) {","\t\t        var ehrId = data.ehrId;","\t\t        var partyData = {","\t\t            firstNames: ime,","\t\t            lastNames: priimek,","\t\t            dateOfBirth: datumRojstva,","\t\t            partyAdditionalInfo: [{key: \"ehrId\", value: ehrId}]","\t\t        };","\t\t        $.ajax({","\t\t            url: baseUrl + \"/demographics/party\",","\t\t            type: 'POST',","\t\t            contentType: 'application/json',","\t\t            data: JSON.stringify(partyData),","\t\t            success: function (party) {","\t\t                if (party.action == 'CREATE') {","\t\t                    $(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>Uspešno kreiran EHR '\" + ehrId + \"'.</span>\");","\t\t                    console.log(\"Uspešno kreiran EHR '\" + ehrId + \"'.\");","\t\t                    $(\"#preberiEHRid\").val(ehrId);","\t\t                }","\t\t            },","\t\t            error: function(err) {","\t\t            \t$(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t            \tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t            }","\t\t        });","\t\t    }","\t\t});","\t}","}","","","function preberiEHRodBolnika() {","\tsessionId = getSessionId();","","\tvar ehrId = $(\"#preberiEHRid\").val();","","\tif (!ehrId || ehrId.trim().length == 0) {","\t\t$(\"#preberiSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim vnesite zahtevan podatek!\");","\t} else {","\t\t$.ajax({","\t\t\turl: baseUrl + \"/demographics/ehr/\" + ehrId + \"/party\",","\t\t\ttype: 'GET',","\t\t\theaders: {\"Ehr-Session\": sessionId},","\t    \tsuccess: function (data) {","\t\t\t\tvar party = data.party;","\t\t\t\t$(\"#preberiSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>Bolnik '\" + party.firstNames + \" \" + party.lastNames + \"', ki se je rodil '\" + party.dateOfBirth + \"'.</span>\");","\t\t\t\tconsole.log(\"Bolnik '\" + party.firstNames + \" \" + party.lastNames + \"', ki se je rodil '\" + party.dateOfBirth + \"'.\");","\t\t\t},","\t\t\terror: function(err) {","\t\t\t\t$(\"#preberiSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t}","\t\t});","\t}\t","}","","","function dodajMeritveVitalnihZnakov() {","\tsessionId = getSessionId();","","\tvar ehrId = $(\"#dodajVitalnoEHR\").val();","\tvar datumInUra = $(\"#dodajVitalnoDatumInUra\").val();","\tvar telesnaVisina = $(\"#dodajVitalnoTelesnaVisina\").val();","\tvar telesnaTeza = $(\"#dodajVitalnoTelesnaTeza\").val();","\tvar telesnaTemperatura = $(\"#dodajVitalnoTelesnaTemperatura\").val();","\tvar sistolicniKrvniTlak = $(\"#dodajVitalnoKrvniTlakSistolicni\").val();","\tvar diastolicniKrvniTlak = $(\"#dodajVitalnoKrvniTlakDiastolicni\").val();","\tvar nasicenostKrviSKisikom = $(\"#dodajVitalnoNasicenostKrviSKisikom\").val();","\tvar merilec = $(\"#dodajVitalnoMerilec\").val();","","\tif (!ehrId || ehrId.trim().length == 0) {","\t\t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim vnesite zahtevane podatke!</span>\");","\t} else {","\t\t$.ajaxSetup({","\t\t    headers: {\"Ehr-Session\": sessionId}","\t\t});","\t\tvar podatki = {","\t\t\t// Preview Structure: https://rest.ehrscape.com/rest/v1/template/Vital%20Signs/example","\t\t    \"ctx/language\": \"en\",","\t\t    \"ctx/territory\": \"SI\",","\t\t    \"ctx/time\": datumInUra,","\t\t    \"vital_signs/height_length/any_event/body_height_length\": telesnaVisina,","\t\t    \"vital_signs/body_weight/any_event/body_weight\": telesnaTeza,","\t\t   \t\"vital_signs/body_temperature/any_event/temperature|magnitude\": telesnaTemperatura,","\t\t    \"vital_signs/body_temperature/any_event/temperature|unit\": \"°C\",","\t\t    \"vital_signs/blood_pressure/any_event/systolic\": sistolicniKrvniTlak,","\t\t    \"vital_signs/blood_pressure/any_event/diastolic\": diastolicniKrvniTlak,","\t\t    \"vital_signs/indirect_oximetry:0/spo2|numerator\": nasicenostKrviSKisikom","\t\t};","\t\tvar parametriZahteve = {","\t\t    \"ehrId\": ehrId,","\t\t    templateId: 'Vital Signs',","\t\t    format: 'FLAT',","\t\t    committer: merilec","\t\t};","\t\t$.ajax({","\t\t    url: baseUrl + \"/composition?\" + $.param(parametriZahteve),","\t\t    type: 'POST',","\t\t    contentType: 'application/json',","\t\t    data: JSON.stringify(podatki),","\t\t    success: function (res) {","\t\t    \tconsole.log(res.meta.href);","\t\t        $(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>\" + res.meta.href + \".</span>\");","\t\t    },","\t\t    error: function(err) {","\t\t    \t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t    }","\t\t});","\t}","}","","","function preberiMeritveVitalnihZnakov() {","\tsessionId = getSessionId();\t","","\tvar ehrId = $(\"#meritveVitalnihZnakovEHRid\").val();","\tvar tip = $(\"#preberiTipZaVitalneZnake\").val();","","\tif (!ehrId || ehrId.trim().length == 0 || !tip || tip.trim().length == 0) {","\t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Prosim vnesite zahtevan podatek!\");","\t} else {","\t\t$.ajax({","\t\t\turl: baseUrl + \"/demographics/ehr/\" + ehrId + \"/party\",","\t    \ttype: 'GET',","\t    \theaders: {\"Ehr-Session\": sessionId},","\t    \tsuccess: function (data) {","\t\t\t\tvar party = data.party;","\t\t\t\t$(\"#rezultatMeritveVitalnihZnakov\").html(\"<br/><span>Pridobivanje podatkov za <b>'\" + tip + \"'</b> bolnika <b>'\" + party.firstNames + \" \" + party.lastNames + \"'</b>.</span><br/><br/>\");","\t\t\t\tif (tip == \"telesna temperatura\") {","\t\t\t\t\t$.ajax({","\t\t\t\t\t    url: baseUrl + \"/view/\" + ehrId + \"/\" + \"body_temperature\",","\t\t\t\t\t    type: 'GET',","\t\t\t\t\t    headers: {\"Ehr-Session\": sessionId},","\t\t\t\t\t    success: function (res) {","\t\t\t\t\t    \tif (res.length > 0) {","\t\t\t\t\t\t    \tvar results = \"<table class='table table-striped table-hover'><tr><th>Datum in ura</th><th class='text-right'>Telesna temperatura</th></tr>\";","\t\t\t\t\t\t        for (var i in res) {","\t\t\t\t\t\t            results += \"<tr><td>\" + res[i].time + \"</td><td class='text-right'>\" + res[i].temperature + \" \" \t+ res[i].unit + \"</td>\";","\t\t\t\t\t\t        }","\t\t\t\t\t\t        results += \"</table>\";","\t\t\t\t\t\t        $(\"#rezultatMeritveVitalnihZnakov\").append(results);","\t\t\t\t\t    \t} else {","\t\t\t\t\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");","\t\t\t\t\t    \t}","\t\t\t\t\t    },","\t\t\t\t\t    error: function() {","\t\t\t\t\t    \t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t\t\t    }","\t\t\t\t\t});","\t\t\t\t} else if (tip == \"telesna teža\") {","\t\t\t\t\t$.ajax({","\t\t\t\t\t    url: baseUrl + \"/view/\" + ehrId + \"/\" + \"weight\",","\t\t\t\t\t    type: 'GET',","\t\t\t\t\t    headers: {\"Ehr-Session\": sessionId},","\t\t\t\t\t    success: function (res) {","\t\t\t\t\t    \tif (res.length > 0) {","\t\t\t\t\t\t    \tvar results = \"<table class='table table-striped table-hover'><tr><th>Datum in ura</th><th class='text-right'>Telesna teža</th></tr>\";","\t\t\t\t\t\t        for (var i in res) {","\t\t\t\t\t\t            results += \"<tr><td>\" + res[i].time + \"</td><td class='text-right'>\" + res[i].weight + \" \" \t+ res[i].unit + \"</td>\";","\t\t\t\t\t\t        }","\t\t\t\t\t\t        results += \"</table>\";","\t\t\t\t\t\t        $(\"#rezultatMeritveVitalnihZnakov\").append(results);","\t\t\t\t\t    \t} else {","\t\t\t\t\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");","\t\t\t\t\t    \t}","\t\t\t\t\t    },","\t\t\t\t\t    error: function() {","\t\t\t\t\t    \t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t\t\t    }","\t\t\t\t\t});\t\t\t\t\t","\t\t\t\t} else if (tip == \"telesna temperatura AQL\") {","\t\t\t\t\tvar AQL = ","\t\t\t\t\t\t\"select \" +","    \t\t\t\t\t\t\"t/data[at0002]/events[at0003]/time/value as cas, \" +","    \t\t\t\t\t\t\"t/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/magnitude as temperatura_vrednost, \" +","    \t\t\t\t\t\t\"t/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/units as temperatura_enota \" +","\t\t\t\t\t\t\"from EHR e[e/ehr_id/value='\" + ehrId + \"'] \" +","\t\t\t\t\t\t\"contains OBSERVATION t[openEHR-EHR-OBSERVATION.body_temperature.v1] \" +","\t\t\t\t\t\t\"where t/data[at0002]/events[at0003]/data[at0001]/items[at0004]/value/magnitude<35 \" +","\t\t\t\t\t\t\"order by t/data[at0002]/events[at0003]/time/value desc \" +","\t\t\t\t\t\t\"limit 10\";","\t\t\t\t\t$.ajax({","\t\t\t\t\t    url: baseUrl + \"/query?\" + $.param({\"aql\": AQL}),","\t\t\t\t\t    type: 'GET',","\t\t\t\t\t    headers: {\"Ehr-Session\": sessionId},","\t\t\t\t\t    success: function (res) {","\t\t\t\t\t    \tvar results = \"<table class='table table-striped table-hover'><tr><th>Datum in ura</th><th class='text-right'>Telesna temperatura</th></tr>\";","\t\t\t\t\t    \tif (res) {","\t\t\t\t\t    \t\tvar rows = res.resultSet;","\t\t\t\t\t\t        for (var i in rows) {","\t\t\t\t\t\t            results += \"<tr><td>\" + rows[i].cas + \"</td><td class='text-right'>\" + rows[i].temperatura_vrednost + \" \" \t+ rows[i].temperatura_enota + \"</td>\";","\t\t\t\t\t\t        }","\t\t\t\t\t\t        results += \"</table>\";","\t\t\t\t\t\t        $(\"#rezultatMeritveVitalnihZnakov\").append(results);","\t\t\t\t\t    \t} else {","\t\t\t\t\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-warning fade-in'>Ni podatkov!</span>\");","\t\t\t\t\t    \t}","","\t\t\t\t\t    },","\t\t\t\t\t    error: function() {","\t\t\t\t\t    \t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t\t\t\t    }","\t\t\t\t\t});","\t\t\t\t}","\t    \t},","\t    \terror: function(err) {","\t    \t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t    \t}","\t\t});","\t}","}","","function ustvariUporabnika(ime, priimek, datum)","{","","","\t\t$.ajaxSetup({","\t\t    headers: {\"Ehr-Session\": sessionId}","\t\t});","\t\t$.ajax({","\t\t    url: baseUrl + \"/ehr\",","\t\t    type: 'POST',","\t\t    success: function (data) {","\t\t        var ehrId = data.ehrId;","\t\t        var partyData = {","\t\t            firstNames: ime,","\t\t            lastNames: priimek,","\t\t            dateOfBirth: datum,","\t\t            partyAdditionalInfo: [{key: \"ehrId\", value: ehrId}]","\t\t        };","\t\t        $.ajax({","\t\t            url: baseUrl + \"/demographics/party\",","\t\t            type: 'POST',","\t\t            contentType: 'application/json',","\t\t            data: JSON.stringify(partyData),","\t\t            success: function (party) {","\t\t                if (party.action == 'CREATE') {","\t\t                    $(\"#obvestiloNarediUporabnika\").html(\"<span class='obvestilo label label-success fade-in'>Uspešno kreiran EHR '\" + ehrId + \"'.</span>\");","\t\t                    console.log(\"Uspešno kreiran uporabnik'\" + ehrId + \"'.\");","\t\t                    uporabniki[uporabniki.length] = ehrId;","\t\t                }","\t\t            },","\t\t            error: function(err) {","\t\t            \t$(\"#kreirajSporocilo\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t            \tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t            }","\t\t        });","\t\t    }","\t\t});","\t\t","}","","$(document).ready(function() {","\t$('#preberiObstojeciEHR').change(function() {","\t\t$(\"#preberiSporocilo\").html(\"\");","\t\t$(\"#preberiEHRid\").val($(this).val());","\t});","\t$('#preberiPredlogoBolnika').change(function() {","\t\t$(\"#kreirajSporocilo\").html(\"\");","\t\tvar podatki = $(this).val().split(\",\");","\t\t$(\"#kreirajIme\").val(podatki[0]);","\t\t$(\"#kreirajPriimek\").val(podatki[1]);","\t\t$(\"#kreirajDatumRojstva\").val(podatki[2]);","\t});","\t$('#preberiObstojeciVitalniZnak').change(function() {","\t\t$(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"\");","\t\tvar podatki = $(this).val().split(\"|\");","\t\t$(\"#dodajVitalnoEHR\").val(podatki[0]);","\t\t$(\"#dodajVitalnoDatumInUra\").val(podatki[1]);","\t\t$(\"#dodajVitalnoTelesnaVisina\").val(podatki[2]);","\t\t$(\"#dodajVitalnoTelesnaTeza\").val(podatki[3]);","\t\t$(\"#dodajVitalnoTelesnaTemperatura\").val(podatki[4]);","\t\t$(\"#dodajVitalnoKrvniTlakSistolicni\").val(podatki[5]);","\t\t$(\"#dodajVitalnoKrvniTlakDiastolicni\").val(podatki[6]);","\t\t$(\"#dodajVitalnoNasicenostKrviSKisikom\").val(podatki[7]);","\t\t$(\"#dodajVitalnoMerilec\").val(podatki[8]);","\t});","\t$('#preberiEhrIdZaVitalneZnake').change(function() {","\t\t$(\"#preberiMeritveVitalnihZnakovSporocilo\").html(\"\");","\t\t$(\"#rezultatMeritveVitalnihZnakov\").html(\"\");","\t\t$(\"#meritveVitalnihZnakovEHRid\").val($(this).val());","\t});","});","","function narediTestnegaUporanika()","{","\t","\tsessionId = getSessionId();","\t","\t$.when(ustvariUporabnika(\"Janez\",\"Novak - student\",\"1993-25-10\"),ustvariUporabnika(\"Miha\",\"Kovač - športnik\",\"1983-10-1\"),ustvariUporabnika(\"Srečko\", \"Upokojeni - upokojenec\",\"1943-3-5\")).done(function(){","\t\t","\t\tustvariVitalneZnake(uporabniki[0],\"2014-10-13T11:35Z\",183,98,36,140,78,\"test\");","\t\tustvariVitalneZnake(uporabniki[0],\"2014-11-13T11:35Z\",170,76,37,130,80,\"test\");","\t\tustvariVitalneZnake(uporabniki[0],\"2014-12-13T11:35Z\",176,70,35,145,76,\"test\");","\t\t","\t\t","\t\t","\t\t","\t\t","\t\t","\t})","","\t","}","function ustvariVitalneZnake(uporabnikID, ura, telVis, telTez, telTemp, sisTlak, diaTlak, sestra)","{","\t","\t\tsessionId = getSessionId();","","\t","\t\t$.ajaxSetup({","\t\t    headers: {\"Ehr-Session\": sessionId}","\t\t});","\t\tvar podatki = {","\t\t\t// Preview Structure: https://rest.ehrscape.com/rest/v1/template/Vital%20Signs/example","\t\t    \"ctx/language\": \"en\",","\t\t    \"ctx/territory\": \"SI\",","\t\t    \"ctx/time\": ura,","\t\t    \"vital_signs/height_length/any_event/body_height_length\": telVis,","\t\t    \"vital_signs/body_weight/any_event/body_weight\": telTez,","\t\t   \t\"vital_signs/body_temperature/any_event/temperature|magnitude\": telTemp,","\t\t    \"vital_signs/body_temperature/any_event/temperature|unit\": \"°C\",","\t\t    \"vital_signs/blood_pressure/any_event/systolic\": sisTlak,","\t\t    \"vital_signs/blood_pressure/any_event/diastolic\": diaTlak,","\t\t  //  \"vital_signs/indirect_oximetry:0/spo2|numerator\": nasicenostKrviSKisikom","\t\t};","\t\tvar parametriZahteve = {","\t\t    \"ehrId\": uporabnikID,","\t\t    templateId: 'Vital Signs',","\t\t    format: 'FLAT',","\t\t    committer: sestra","\t\t    ","\t\t};","\t\t$.ajax({","\t\t    url: baseUrl + \"/composition?\" + $.param(parametriZahteve),","\t\t    type: 'POST',","\t\t    contentType: 'application/json',","\t\t    data: JSON.stringify(podatki),","\t\t    success: function (res) {","\t\t    \tconsole.log(res.meta.href);","\t\t        $(\"#dodajMeritveVitalnihZnakovSporocilo\").html(\"<span class='obvestilo label label-success fade-in'>\" + res.meta.href + \".</span>\");","\t\t    },","\t\t    error: function(err) {","\t\t    \t$(\"#sporociloVitalniZnaki\").html(\"<span class='obvestilo label label-danger fade-in'>Napaka '\" + JSON.parse(err.responseText).userMessage + \"'!\");","\t\t\t\tconsole.log(JSON.parse(err.responseText).userMessage);","\t\t    }","\t\t});","\t","","\t","}","","","function narisiGraf()","{","\tvar margin = {top: 20, right: 20, bottom: 30, left: 50},","    width = 960 - margin.left - margin.right,","    height = 500 - margin.top - margin.bottom;","","var parseDate = d3.time.format(\"%Y%m%d\").parse;","","var x = d3.time.scale()","    .range([0, width]);","","var y = d3.scale.linear()","    .range([height, 0]);","","var xAxis = d3.svg.axis()","    .scale(x)","    .orient(\"bottom\");","","var yAxis = d3.svg.axis()","    .scale(y)","    .orient(\"left\");","","var area = d3.svg.area()","    .x(function(d) { return x(d.date); })","    .y0(function(d) { return y(d.low); })","    .y1(function(d) { return y(d.high); });","","var svg = d3.select(\"body\").append(\"svg\")","    .attr(\"width\", width + margin.left + margin.right)","    .attr(\"height\", height + margin.top + margin.bottom)","  .append(\"g\")","    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");","","d3.tsv(\"data.tsv\", function(error, data) {","  data.forEach(function(d) {","    d.date = parseDate(d.date);","    d.low = +d.low;","    d.high = +d.high;","  });","","  x.domain(d3.extent(data, function(d) { return d.date; }));","  y.domain([d3.min(data, function(d) { return d.low; }), d3.max(data, function(d) { return d.high; })]);","","  svg.append(\"path\")","      .datum(data)","      .attr(\"class\", \"area\")","      .attr(\"d\", area);","","  svg.append(\"g\")","      .attr(\"class\", \"x axis\")","      .attr(\"transform\", \"translate(0,\" + height + \")\")","      .call(xAxis);","","  svg.append(\"g\")","      .attr(\"class\", \"y axis\")","      .call(yAxis)","    .append(\"text\")","      .attr(\"transform\", \"rotate(-90)\")","      .attr(\"y\", 6)","      .attr(\"dy\", \".71em\")","      .style(\"text-anchor\", \"end\")","      .text(\"Temperature (ºF)\");","});","\t","}"]}]}],[{"group":"doc","deltas":[{"start":{"row":328,"column":40},"end":{"row":328,"column":50},"action":"remove","lines":[" - student"]}]}],[{"group":"doc","deltas":[{"start":{"row":328,"column":87},"end":{"row":328,"column":98},"action":"remove","lines":[" - športnik"]}]}],[{"group":"doc","deltas":[{"start":{"row":328,"column":140},"end":{"row":328,"column":153},"action":"remove","lines":[" - upokojenec"]}]}],[{"group":"doc","deltas":[{"start":{"row":345,"column":1},"end":{"row":345,"column":2},"action":"insert","lines":["<"]}]}],[{"group":"doc","deltas":[{"start":{"row":345,"column":1},"end":{"row":345,"column":2},"action":"remove","lines":["<"]}]}],[{"group":"doc","deltas":[{"start":{"row":330,"column":74},"end":{"row":330,"column":78},"action":"remove","lines":["test"]},{"start":{"row":330,"column":74},"end":{"row":330,"column":75},"action":"insert","lines":["A"]}]}],[{"group":"doc","deltas":[{"start":{"row":330,"column":75},"end":{"row":330,"column":76},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":330,"column":76},"end":{"row":330,"column":77},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":331,"column":77},"end":{"row":331,"column":78},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":331,"column":76},"end":{"row":331,"column":77},"action":"remove","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":331,"column":75},"end":{"row":331,"column":76},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":331,"column":74},"end":{"row":331,"column":75},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":331,"column":74},"end":{"row":331,"column":75},"action":"insert","lines":["M"]}]}],[{"group":"doc","deltas":[{"start":{"row":331,"column":75},"end":{"row":331,"column":76},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":331,"column":76},"end":{"row":331,"column":77},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":331,"column":77},"end":{"row":331,"column":78},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":332,"column":77},"end":{"row":332,"column":78},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":332,"column":76},"end":{"row":332,"column":77},"action":"remove","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":332,"column":75},"end":{"row":332,"column":76},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":332,"column":74},"end":{"row":332,"column":75},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":332,"column":74},"end":{"row":332,"column":75},"action":"insert","lines":["T"]}]}],[{"group":"doc","deltas":[{"start":{"row":332,"column":75},"end":{"row":332,"column":76},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":332,"column":76},"end":{"row":332,"column":77},"action":"insert","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":332,"column":77},"end":{"row":332,"column":78},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":332,"column":78},"end":{"row":332,"column":79},"action":"insert","lines":["ž"]}]}],[{"group":"doc","deltas":[{"start":{"row":334,"column":1},"end":{"row":334,"column":55},"action":"insert","lines":["console.log(JSON.parse(err.responseText).userMessage);"]}]}],[{"group":"doc","deltas":[{"start":{"row":323,"column":28},"end":{"row":323,"column":29},"action":"insert","lines":["b"]}]}],[{"group":"doc","deltas":[{"start":{"row":323,"column":9},"end":{"row":323,"column":33},"action":"remove","lines":["narediTestnegaUporabnika"]},{"start":{"row":323,"column":9},"end":{"row":323,"column":33},"action":"insert","lines":["narediTestnegaUporabnika"]}]}],[{"group":"doc","deltas":[{"start":{"row":332,"column":37},"end":{"row":332,"column":54},"action":"remove","lines":["2014-12-13T11:35Z"]},{"start":{"row":332,"column":37},"end":{"row":332,"column":54},"action":"insert","lines":["2014-11-05T15:12Z"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":17},"end":{"row":16,"column":18},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":0},"end":{"row":17,"column":0},"action":"remove","lines":["var uporabniki []; ",""]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":0},"end":{"row":16,"column":1},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":1},"end":{"row":16,"column":2},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":2},"end":{"row":16,"column":3},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":3},"end":{"row":16,"column":4},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":4},"end":{"row":16,"column":5},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":5},"end":{"row":16,"column":6},"action":"insert","lines":["p"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":6},"end":{"row":16,"column":7},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":7},"end":{"row":16,"column":8},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":8},"end":{"row":16,"column":9},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":9},"end":{"row":16,"column":10},"action":"insert","lines":["b"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":10},"end":{"row":16,"column":11},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":11},"end":{"row":16,"column":12},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":12},"end":{"row":16,"column":13},"action":"insert","lines":["k"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":13},"end":{"row":16,"column":14},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":14},"end":{"row":16,"column":15},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":15},"end":{"row":16,"column":16},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":16},"end":{"row":16,"column":17},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":17},"end":{"row":16,"column":19},"action":"insert","lines":["[]"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":18},"end":{"row":16,"column":19},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":20},"end":{"row":16,"column":21},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":21},"end":{"row":16,"column":22},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":21},"end":{"row":16,"column":22},"action":"remove","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":20},"end":{"row":16,"column":21},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":20},"end":{"row":16,"column":21},"action":"insert","lines":[":"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":21},"end":{"row":16,"column":22},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":21},"end":{"row":16,"column":22},"action":"remove","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":20},"end":{"row":16,"column":21},"action":"remove","lines":[":"]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":20},"end":{"row":16,"column":21},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":333,"column":1},"end":{"row":334,"column":2},"action":"remove","lines":["console.log(JSON.parse(err.responseText).userMessage);\t","\t\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":330,"column":33},"end":{"row":330,"column":34},"action":"remove","lines":["0"]},{"start":{"row":330,"column":33},"end":{"row":330,"column":34},"action":"insert","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":331,"column":33},"end":{"row":331,"column":34},"action":"remove","lines":["0"]},{"start":{"row":331,"column":33},"end":{"row":331,"column":34},"action":"insert","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":90},"end":{"row":327,"column":99},"action":"remove","lines":["1983-10-1"]},{"start":{"row":327,"column":90},"end":{"row":327,"column":106},"action":"insert","lines":["1938-10-11T14:58"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":93},"end":{"row":327,"column":94},"action":"remove","lines":["8"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":92},"end":{"row":327,"column":93},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":92},"end":{"row":327,"column":93},"action":"insert","lines":["7"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":93},"end":{"row":327,"column":94},"action":"insert","lines":["6"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":102},"end":{"row":327,"column":103},"action":"remove","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":102},"end":{"row":327,"column":103},"action":"insert","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":104},"end":{"row":327,"column":106},"action":"remove","lines":["58"]},{"start":{"row":327,"column":104},"end":{"row":327,"column":105},"action":"insert","lines":["5"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":105},"end":{"row":327,"column":106},"action":"insert","lines":["0"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":43},"end":{"row":327,"column":53},"action":"remove","lines":["1993-25-10"]},{"start":{"row":327,"column":43},"end":{"row":327,"column":59},"action":"insert","lines":["1976-10-11T11:50"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":46},"end":{"row":327,"column":47},"action":"remove","lines":["6"]},{"start":{"row":327,"column":46},"end":{"row":327,"column":47},"action":"insert","lines":["9"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":45},"end":{"row":327,"column":46},"action":"remove","lines":["7"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":46},"end":{"row":327,"column":47},"action":"insert","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":51},"end":{"row":327,"column":53},"action":"remove","lines":["11"]},{"start":{"row":327,"column":51},"end":{"row":327,"column":52},"action":"insert","lines":["1"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":52},"end":{"row":327,"column":53},"action":"insert","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":53},"end":{"row":327,"column":54},"action":"insert","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":53},"end":{"row":327,"column":54},"action":"remove","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":54},"end":{"row":327,"column":56},"action":"remove","lines":["11"]},{"start":{"row":327,"column":54},"end":{"row":327,"column":55},"action":"insert","lines":["0"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":55},"end":{"row":327,"column":56},"action":"insert","lines":["9"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":156},"end":{"row":327,"column":164},"action":"remove","lines":["1943-3-5"]},{"start":{"row":327,"column":156},"end":{"row":327,"column":172},"action":"insert","lines":["1976-10-11T11:50"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":158},"end":{"row":327,"column":160},"action":"remove","lines":["76"]},{"start":{"row":327,"column":158},"end":{"row":327,"column":159},"action":"insert","lines":["4"]}]}],[{"group":"doc","deltas":[{"start":{"row":327,"column":159},"end":{"row":327,"column":160},"action":"insert","lines":["3"]}]}],[{"group":"doc","deltas":[{"start":{"row":146,"column":0},"end":{"row":146,"column":1},"action":"insert","lines":["<"]}]}],[{"group":"doc","deltas":[{"start":{"row":146,"column":1},"end":{"row":146,"column":2},"action":"insert","lines":["<"]}]}],[{"group":"doc","deltas":[{"start":{"row":146,"column":2},"end":{"row":146,"column":3},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":146,"column":2},"end":{"row":146,"column":3},"action":"remove","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":146,"column":1},"end":{"row":146,"column":2},"action":"remove","lines":["<"]}]}],[{"group":"doc","deltas":[{"start":{"row":146,"column":0},"end":{"row":146,"column":1},"action":"remove","lines":["<"]}]}],[{"group":"doc","deltas":[{"start":{"row":146,"column":0},"end":{"row":146,"column":1},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":146,"column":1},"end":{"row":146,"column":2},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":146,"column":1},"end":{"row":146,"column":2},"action":"remove","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":146,"column":1},"end":{"row":146,"column":2},"action":"insert","lines":["*"]}]}],[{"group":"doc","deltas":[{"start":{"row":249,"column":0},"end":{"row":249,"column":1},"action":"insert","lines":["*"]}]}],[{"group":"doc","deltas":[{"start":{"row":249,"column":1},"end":{"row":249,"column":2},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":392,"column":0},"end":{"row":452,"column":3},"action":"remove","lines":["\tvar margin = {top: 20, right: 20, bottom: 30, left: 50},","    width = 960 - margin.left - margin.right,","    height = 500 - margin.top - margin.bottom;","","var parseDate = d3.time.format(\"%Y%m%d\").parse;","","var x = d3.time.scale()","    .range([0, width]);","","var y = d3.scale.linear()","    .range([height, 0]);","","var xAxis = d3.svg.axis()","    .scale(x)","    .orient(\"bottom\");","","var yAxis = d3.svg.axis()","    .scale(y)","    .orient(\"left\");","","var area = d3.svg.area()","    .x(function(d) { return x(d.date); })","    .y0(function(d) { return y(d.low); })","    .y1(function(d) { return y(d.high); });","","var svg = d3.select(\"body\").append(\"svg\")","    .attr(\"width\", width + margin.left + margin.right)","    .attr(\"height\", height + margin.top + margin.bottom)","  .append(\"g\")","    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");","","d3.tsv(\"data.tsv\", function(error, data) {","  data.forEach(function(d) {","    d.date = parseDate(d.date);","    d.low = +d.low;","    d.high = +d.high;","  });","","  x.domain(d3.extent(data, function(d) { return d.date; }));","  y.domain([d3.min(data, function(d) { return d.low; }), d3.max(data, function(d) { return d.high; })]);","","  svg.append(\"path\")","      .datum(data)","      .attr(\"class\", \"area\")","      .attr(\"d\", area);","","  svg.append(\"g\")","      .attr(\"class\", \"x axis\")","      .attr(\"transform\", \"translate(0,\" + height + \")\")","      .call(xAxis);","","  svg.append(\"g\")","      .attr(\"class\", \"y axis\")","      .call(yAxis)","    .append(\"text\")","      .attr(\"transform\", \"rotate(-90)\")","      .attr(\"y\", 6)","      .attr(\"dy\", \".71em\")","      .style(\"text-anchor\", \"end\")","      .text(\"Temperature (ºF)\");","});"]},{"start":{"row":392,"column":0},"end":{"row":451,"column":0},"action":"insert","lines":["var margin = {top: 20, right: 20, bottom: 30, left: 50},","    width = 960 - margin.left - margin.right,","    height = 500 - margin.top - margin.bottom;","","var parseDate = d3.time.format(\"%d-%b-%y\").parse;","","var x = d3.time.scale()","    .range([0, width]);","","var y = d3.scale.linear()","    .range([height, 0]);","","var xAxis = d3.svg.axis()","    .scale(x)","    .orient(\"bottom\");","","var yAxis = d3.svg.axis()","    .scale(y)","    .orient(\"left\");","","var line = d3.svg.line()","    .x(function(d) { return x(d.date); })","    .y(function(d) { return y(d.close); });","","var svg = d3.select(\"body\").append(\"svg\")","    .attr(\"width\", width + margin.left + margin.right)","    .attr(\"height\", height + margin.top + margin.bottom)","  .append(\"g\")","    .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");","","d3.tsv(\"data.tsv\", function(error, data) {","  data.forEach(function(d) {","    d.date = parseDate(d.date);","    d.close = +d.close;","  });","","  x.domain(d3.extent(data, function(d) { return d.date; }));","  y.domain(d3.extent(data, function(d) { return d.close; }));","","  svg.append(\"g\")","      .attr(\"class\", \"x axis\")","      .attr(\"transform\", \"translate(0,\" + height + \")\")","      .call(xAxis);","","  svg.append(\"g\")","      .attr(\"class\", \"y axis\")","      .call(yAxis)","    .append(\"text\")","      .attr(\"transform\", \"rotate(-90)\")","      .attr(\"y\", 6)","      .attr(\"dy\", \".71em\")","      .style(\"text-anchor\", \"end\")","      .text(\"Price ($)\");","","  svg.append(\"path\")","      .datum(data)","      .attr(\"class\", \"line\")","      .attr(\"d\", line);","});",""]}]}]]},"ace":{"folds":[{"start":{"row":17,"column":32},"end":{"row":61,"column":0},"placeholder":"..."},{"start":{"row":64,"column":32},"end":{"row":87,"column":0},"placeholder":"..."},{"start":{"row":90,"column":39},"end":{"row":143,"column":0},"placeholder":"..."},{"start":{"row":146,"column":2},"end":{"row":249,"column":0},"placeholder":"..."},{"start":{"row":251,"column":1},"end":{"row":288,"column":0},"placeholder":"..."},{"start":{"row":290,"column":30},"end":{"row":320,"column":0},"placeholder":"..."},{"start":{"row":323,"column":1},"end":{"row":340,"column":0},"placeholder":"..."},{"start":{"row":342,"column":1},"end":{"row":387,"column":0},"placeholder":"..."}],"scrolltop":801,"scrollleft":0,"selection":{"start":{"row":451,"column":0},"end":{"row":451,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":408,"state":"no_regex","mode":"ace/mode/javascript"}},"timestamp":1419197543394,"hash":"7b55f5a37da1ab95525532a47101f5db6cb2ca39"}